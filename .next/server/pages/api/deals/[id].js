"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/deals/[id]";
exports.ids = ["pages/api/deals/[id]"];
exports.modules = {

/***/ "(api-node)/./lib/auth.js":
/*!*********************!*\
  !*** ./lib/auth.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   accountManager: () => (/* binding */ accountManager),\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   clientAccountManager: () => (/* binding */ clientAccountManager),\n/* harmony export */   clientAuth: () => (/* binding */ clientAuth)\n/* harmony export */ });\n// lib/auth.js\n// Declare variables to hold modules\nlet bcrypt;\nlet uuidv4;\nlet queryFn;\nlet poolObj;\n// Only initialize on the server\nif (true) {\n    try {\n        // Server-side imports\n        bcrypt = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n        const { v4 } = __webpack_require__(/*! uuid */ \"uuid\");\n        uuidv4 = v4;\n        // Import database functions - using dynamic import to avoid webpack issues\n        const dbModule = __webpack_require__(/*! ./db.js */ \"(api-node)/./lib/db.js\");\n        queryFn = dbModule.query;\n        poolObj = dbModule.pool;\n    } catch (error) {\n        console.error('Error initializing auth module:', error);\n        // Provide fallbacks if imports fail\n        bcrypt = {\n            hash: async ()=>'hash-function-not-available',\n            compare: async ()=>false\n        };\n        uuidv4 = ()=>'uuid-function-not-available';\n        queryFn = async ()=>{\n            throw new Error('Database query function not available');\n        };\n        poolObj = {\n            query: async ()=>{\n                throw new Error('Database pool not available');\n            }\n        };\n    }\n} else {}\n// Simple session-based authentication\nconst auth = {\n    // Create a hashed password\n    async hashPassword (password) {\n        // Can run on client or server, but only does real work on server\n        if (false) {}\n        return await bcrypt.hash(password, 10);\n    },\n    // Compare password with hash\n    async comparePassword (password, hash) {\n        // Can run on client or server, but only does real work on server\n        if (false) {}\n        return await bcrypt.compare(password, hash);\n    },\n    // Find user by email - server only\n    async findUserByEmail (email) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn(`SELECT u.*, a.account_name, a.is_active as account_is_active, r.role_name \n         FROM users u\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE u.email = $1`, [\n                email\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error finding user by email:', error);\n            throw error;\n        }\n    },\n    // Find user by ID - server only\n    async findUserById (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn(`SELECT u.*, a.account_name, a.is_active as account_is_active, r.role_name, r.permissions\n         FROM users u\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE u.user_id = $1`, [\n                userId\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error finding user by ID:', error);\n            throw error;\n        }\n    },\n    // Create a new session - server only\n    async createSession (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        const sessionToken = uuidv4();\n        const expiresAt = new Date();\n        expiresAt.setDate(expiresAt.getDate() + 7); // 7 days expiration\n        try {\n            await queryFn('INSERT INTO sessions (user_id, session_token, expires_at) VALUES ($1, $2, $3)', [\n                userId,\n                sessionToken,\n                expiresAt\n            ]);\n            return sessionToken;\n        } catch (error) {\n            console.error('Error creating session:', error);\n            throw error;\n        }\n    },\n    // Verify a session token - server only\n    async verifySession (sessionToken) {\n        // Ensure we're running on the server\n        if (false) {}\n        console.log('verifySession called with token', {\n            tokenLength: sessionToken ? sessionToken.length : 0,\n            tokenPrefix: sessionToken ? sessionToken.substring(0, 8) + '...' : 'none'\n        });\n        try {\n            const result = await queryFn(`SELECT u.*, s.session_id, s.expires_at, a.account_name, a.is_active as account_is_active, r.role_name, r.permissions\n         FROM sessions s\n         JOIN users u ON s.user_id = u.user_id\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE s.session_token = $1 AND s.expires_at > NOW()`, [\n                sessionToken\n            ]);\n            console.log('verifySession query result', {\n                found: result.rowCount > 0,\n                userData: result.rowCount > 0 ? {\n                    user_id: result.rows[0].user_id,\n                    email: result.rows[0].email,\n                    account_id: result.rows[0].account_id,\n                    is_account_admin: result.rows[0].is_account_admin,\n                    account_name: result.rows[0].account_name,\n                    role_name: result.rows[0].role_name\n                } : null\n            });\n            // Add standard property names for consistency\n            if (result.rowCount > 0) {\n                const user = result.rows[0];\n                // Map database field names to the camelCase format expected by frontend\n                user.id = user.user_id;\n                user.firstName = user.first_name;\n                user.lastName = user.last_name;\n                user.accountId = user.account_id;\n                user.isAdmin = user.is_account_admin;\n                user.accountName = user.account_name;\n            }\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error verifying session:', error);\n            throw error;\n        }\n    },\n    // Invalidate a session - server only\n    async invalidateSession (sessionToken) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            await queryFn('DELETE FROM sessions WHERE session_token = $1', [\n                sessionToken\n            ]);\n            return true;\n        } catch (error) {\n            console.error('Error invalidating session:', error);\n            throw error;\n        }\n    },\n    // Create a password reset token - server only\n    async createPasswordResetToken (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        const token = uuidv4();\n        const expiresAt = new Date();\n        expiresAt.setHours(expiresAt.getHours() + 24); // 24 hours expiration\n        try {\n            await queryFn('INSERT INTO password_reset_tokens (user_id, token, expires_at) VALUES ($1, $2, $3)', [\n                userId,\n                token,\n                expiresAt\n            ]);\n            return token;\n        } catch (error) {\n            console.error('Error creating password reset token:', error);\n            throw error;\n        }\n    },\n    // Verify a password reset token - server only\n    async verifyResetToken (token) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn('SELECT * FROM password_reset_tokens WHERE token = $1 AND expires_at > NOW()', [\n                token\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error verifying reset token:', error);\n            throw error;\n        }\n    },\n    // Reset password - server only\n    async resetPassword (token, newPassword) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const tokenRecord = await this.verifyResetToken(token);\n            if (!tokenRecord) {\n                return {\n                    success: false,\n                    error: 'Invalid or expired token'\n                };\n            }\n            const passwordHash = await this.hashPassword(newPassword);\n            // Update password\n            await queryFn('UPDATE users SET password_hash = $1, updated_at = NOW() WHERE user_id = $2', [\n                passwordHash,\n                tokenRecord.user_id\n            ]);\n            // Delete the token\n            await queryFn('DELETE FROM password_reset_tokens WHERE token_id = $1', [\n                tokenRecord.token_id\n            ]);\n            return {\n                success: true\n            };\n        } catch (error) {\n            console.error('Error resetting password:', error);\n            throw error;\n        }\n    }\n};\n// Account management - all methods are server-only\nconst accountManager = {\n    // Create a new account with admin user\n    async createAccount (accountData, userData) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            // Start a transaction\n            await queryFn('BEGIN');\n            // Create account\n            const accountResult = await queryFn('INSERT INTO accounts (account_name, account_domain, plan_id, billing_email) VALUES ($1, $2, $3, $4) RETURNING *', [\n                accountData.accountName,\n                accountData.accountDomain || null,\n                accountData.planId || 1,\n                accountData.billingEmail\n            ]);\n            const account = accountResult.rows[0];\n            // Hash password\n            const passwordHash = await auth.hashPassword(userData.password);\n            // Create admin user (role_id 1 = Admin)\n            const userResult = await queryFn(`INSERT INTO users (account_id, email, password_hash, first_name, last_name, role_id, is_account_admin) \n         VALUES ($1, $2, $3, $4, $5, 1, TRUE) RETURNING *`, [\n                account.account_id,\n                userData.email,\n                passwordHash,\n                userData.firstName,\n                userData.lastName\n            ]);\n            const admin = userResult.rows[0];\n            // Commit transaction\n            await queryFn('COMMIT');\n            return {\n                account,\n                admin\n            };\n        } catch (error) {\n            // Rollback transaction on error\n            await queryFn('ROLLBACK');\n            console.error('Error creating account:', error);\n            throw error;\n        }\n    }\n};\n// Create mock implementations for client-side use\nconst createMockAuth = ()=>{\n    const mockAuth = {\n        // Mock implementations that are safe to use on the client\n        async hashPassword (password) {\n            if (true) {\n                // When running on the server, use the real implementation\n                return auth.hashPassword(password);\n            }\n            // On client, just return a placeholder (real hashing happens server-side)\n            console.warn('hashPassword called on client, real hashing will happen server-side');\n            return `mock-hash-${password.length}`;\n        },\n        async comparePassword (password, hash) {\n            if (true) {\n                // When running on the server, use the real implementation\n                return auth.comparePassword(password, hash);\n            }\n            // On client, just return a placeholder (real comparison happens server-side)\n            console.warn('comparePassword called on client, real comparison will happen server-side');\n            return false;\n        },\n        // These methods should be called via API endpoints on the client\n        async findUserByEmail () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async findUserById () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createSession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async verifySession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async invalidateSession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createPasswordResetToken () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async verifyResetToken () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async resetPassword () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        }\n    };\n    return mockAuth;\n};\n// Create a mock account manager for client-side use\nconst createMockAccountManager = ()=>{\n    const mockAccountManager = {\n        // All methods should be called via API endpoints on the client\n        async createAccount () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async getAccountUsers () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createUser () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async updateUser () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async updateAccount () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        }\n    };\n    return mockAccountManager;\n};\n// Export the appropriate implementations based on environment\nconst clientAuth =  false ? 0 : auth;\nconst clientAccountManager =  false ? 0 : accountManager;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUlQLE1BQU07UUFDbEI7UUFFQSxNQUFNVztZQUNKLE1BQU0sSUFBSVgsTUFBTTtRQUNsQjtRQUVBLE1BQU1hO1lBQ0osTUFBTSxJQUFJYixNQUFNO1FBQ2xCO1FBRUEsTUFBTW1CO1lBQ0osTUFBTSxJQUFJbkIsTUFBTTtRQUNsQjtRQUVBLE1BQU15QztZQUNKLE1BQU0sSUFBSXpDLE1BQU07UUFDbEI7UUFFQSxNQUFNMEM7WUFDSixNQUFNLElBQUkxQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTThDO1lBQ0osTUFBTSxJQUFJOUMsTUFBTTtRQUNsQjtRQUVBLE1BQU0rQztZQUNKLE1BQU0sSUFBSS9DLE1BQU07UUFDbEI7SUFDRjtJQUVBLE9BQU9nRTtBQUNUO0FBRUEsb0RBQW9EO0FBQ3BELE1BQU1DLDJCQUEyQjtJQUMvQixNQUFNQyxxQkFBcUI7UUFDekIsK0RBQStEO1FBQy9ELE1BQU1aO1lBQ0osTUFBTSxJQUFJdEQsTUFBTTtRQUNsQjtRQUVBLE1BQU1tRTtZQUNKLE1BQU0sSUFBSW5FLE1BQU07UUFDbEI7UUFFQSxNQUFNb0U7WUFDSixNQUFNLElBQUlwRSxNQUFNO1FBQ2xCO1FBRUEsTUFBTXFFO1lBQ0osTUFBTSxJQUFJckUsTUFBTTtRQUNsQjtRQUVBLE1BQU1zRTtZQUNKLE1BQU0sSUFBSXRFLE1BQU07UUFDbEI7SUFDRjtJQUVBLE9BQU9rRTtBQUNUO0FBRUEsOERBQThEO0FBQ3ZELE1BQU1LLGFBQWEsTUFBNkIsR0FBR1IsQ0FBZ0JBLEdBQUc5RCxLQUFLO0FBQzNFLE1BQU11RSx1QkFBdUIsTUFBNkIsR0FBR1AsQ0FBMEJBLEdBQUdaLGVBQWUiLCJzb3VyY2VzIjpbIkM6XFx2aW5vZFxccHJvamVjdHNcXGlubnZlc3RcXFBPQ1xcaW5udmVzdGFpXFxsaWJcXGF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL2F1dGguanNcclxuXHJcbi8vIERlY2xhcmUgdmFyaWFibGVzIHRvIGhvbGQgbW9kdWxlc1xyXG5sZXQgYmNyeXB0O1xyXG5sZXQgdXVpZHY0O1xyXG5sZXQgcXVlcnlGbjtcclxubGV0IHBvb2xPYmo7XHJcblxyXG4vLyBPbmx5IGluaXRpYWxpemUgb24gdGhlIHNlcnZlclxyXG5pZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICB0cnkge1xyXG4gICAgLy8gU2VydmVyLXNpZGUgaW1wb3J0c1xyXG4gICAgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKTtcclxuICAgIGNvbnN0IHsgdjQgfSA9IHJlcXVpcmUoJ3V1aWQnKTtcclxuICAgIHV1aWR2NCA9IHY0O1xyXG4gICAgXHJcbiAgICAvLyBJbXBvcnQgZGF0YWJhc2UgZnVuY3Rpb25zIC0gdXNpbmcgZHluYW1pYyBpbXBvcnQgdG8gYXZvaWQgd2VicGFjayBpc3N1ZXNcclxuICAgIGNvbnN0IGRiTW9kdWxlID0gcmVxdWlyZSgnLi9kYi5qcycpO1xyXG4gICAgcXVlcnlGbiA9IGRiTW9kdWxlLnF1ZXJ5O1xyXG4gICAgcG9vbE9iaiA9IGRiTW9kdWxlLnBvb2w7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBhdXRoIG1vZHVsZTonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIC8vIFByb3ZpZGUgZmFsbGJhY2tzIGlmIGltcG9ydHMgZmFpbFxyXG4gICAgYmNyeXB0ID0ge1xyXG4gICAgICBoYXNoOiBhc3luYyAoKSA9PiAnaGFzaC1mdW5jdGlvbi1ub3QtYXZhaWxhYmxlJyxcclxuICAgICAgY29tcGFyZTogYXN5bmMgKCkgPT4gZmFsc2VcclxuICAgIH07XHJcbiAgICB1dWlkdjQgPSAoKSA9PiAndXVpZC1mdW5jdGlvbi1ub3QtYXZhaWxhYmxlJztcclxuICAgIHF1ZXJ5Rm4gPSBhc3luYyAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcnkgZnVuY3Rpb24gbm90IGF2YWlsYWJsZScpOyB9O1xyXG4gICAgcG9vbE9iaiA9IHsgcXVlcnk6IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBwb29sIG5vdCBhdmFpbGFibGUnKTsgfSB9O1xyXG4gIH1cclxufSBlbHNlIHtcclxuICAvLyBDbGllbnQtc2lkZSBzdHVic1xyXG4gIGJjcnlwdCA9IHtcclxuICAgIGhhc2g6IGFzeW5jICgpID0+ICdjbGllbnQtc2lkZS1zdHViLWhhc2gnLFxyXG4gICAgY29tcGFyZTogYXN5bmMgKCkgPT4gZmFsc2VcclxuICB9O1xyXG4gIHV1aWR2NCA9ICgpID0+ICdjbGllbnQtc2lkZS1zdHViLXV1aWQnO1xyXG4gIHF1ZXJ5Rm4gPSBhc3luYyAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcmllcyBjYW5ub3QgYmUgZXhlY3V0ZWQgb24gdGhlIGNsaWVudCBzaWRlJyk7IH07XHJcbiAgcG9vbE9iaiA9IHsgcXVlcnk6IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBwb29sIGNhbm5vdCBiZSB1c2VkIG9uIHRoZSBjbGllbnQgc2lkZScpOyB9IH07XHJcbn1cclxuXHJcbi8vIFNpbXBsZSBzZXNzaW9uLWJhc2VkIGF1dGhlbnRpY2F0aW9uXHJcbmV4cG9ydCBjb25zdCBhdXRoID0ge1xyXG4gIC8vIENyZWF0ZSBhIGhhc2hlZCBwYXNzd29yZFxyXG4gIGFzeW5jIGhhc2hQYXNzd29yZChwYXNzd29yZCkge1xyXG4gICAgLy8gQ2FuIHJ1biBvbiBjbGllbnQgb3Igc2VydmVyLCBidXQgb25seSBkb2VzIHJlYWwgd29yayBvbiBzZXJ2ZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ2hhc2hQYXNzd29yZCBjYWxsZWQgb24gY2xpZW50LCByZWFsIGhhc2hpbmcgd2lsbCBoYXBwZW4gc2VydmVyLXNpZGUnKTtcclxuICAgICAgcmV0dXJuIGBtb2NrLWhhc2gtJHtwYXNzd29yZC5sZW5ndGh9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApO1xyXG4gIH0sXHJcblxyXG4gIC8vIENvbXBhcmUgcGFzc3dvcmQgd2l0aCBoYXNoXHJcbiAgYXN5bmMgY29tcGFyZVBhc3N3b3JkKHBhc3N3b3JkLCBoYXNoKSB7XHJcbiAgICAvLyBDYW4gcnVuIG9uIGNsaWVudCBvciBzZXJ2ZXIsIGJ1dCBvbmx5IGRvZXMgcmVhbCB3b3JrIG9uIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignY29tcGFyZVBhc3N3b3JkIGNhbGxlZCBvbiBjbGllbnQsIHJlYWwgY29tcGFyaXNvbiB3aWxsIGhhcHBlbiBzZXJ2ZXItc2lkZScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2gpO1xyXG4gIH0sXHJcblxyXG4gIC8vIEZpbmQgdXNlciBieSBlbWFpbCAtIHNlcnZlciBvbmx5XHJcbiAgYXN5bmMgZmluZFVzZXJCeUVtYWlsKGVtYWlsKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeUZuKFxyXG4gICAgICAgIGBTRUxFQ1QgdS4qLCBhLmFjY291bnRfbmFtZSwgYS5pc19hY3RpdmUgYXMgYWNjb3VudF9pc19hY3RpdmUsIHIucm9sZV9uYW1lIFxyXG4gICAgICAgICBGUk9NIHVzZXJzIHVcclxuICAgICAgICAgSk9JTiBhY2NvdW50cyBhIE9OIHUuYWNjb3VudF9pZCA9IGEuYWNjb3VudF9pZFxyXG4gICAgICAgICBKT0lOIHJvbGVzIHIgT04gdS5yb2xlX2lkID0gci5yb2xlX2lkXHJcbiAgICAgICAgIFdIRVJFIHUuZW1haWwgPSAkMWAsXHJcbiAgICAgICAgW2VtYWlsXVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmaW5kaW5nIHVzZXIgYnkgZW1haWw6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBGaW5kIHVzZXIgYnkgSUQgLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIGZpbmRVc2VyQnlJZCh1c2VySWQpIHtcclxuICAgIC8vIEVuc3VyZSB3ZSdyZSBydW5uaW5nIG9uIHRoZSBzZXJ2ZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIHRoZSBzZXJ2ZXIgc2lkZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgYFNFTEVDVCB1LiosIGEuYWNjb3VudF9uYW1lLCBhLmlzX2FjdGl2ZSBhcyBhY2NvdW50X2lzX2FjdGl2ZSwgci5yb2xlX25hbWUsIHIucGVybWlzc2lvbnNcclxuICAgICAgICAgRlJPTSB1c2VycyB1XHJcbiAgICAgICAgIEpPSU4gYWNjb3VudHMgYSBPTiB1LmFjY291bnRfaWQgPSBhLmFjY291bnRfaWRcclxuICAgICAgICAgSk9JTiByb2xlcyByIE9OIHUucm9sZV9pZCA9IHIucm9sZV9pZFxyXG4gICAgICAgICBXSEVSRSB1LnVzZXJfaWQgPSAkMWAsXHJcbiAgICAgICAgW3VzZXJJZF1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmluZGluZyB1c2VyIGJ5IElEOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLy8gQ3JlYXRlIGEgbmV3IHNlc3Npb24gLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24odXNlcklkKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSB1dWlkdjQoKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBleHBpcmVzQXQuc2V0RGF0ZShleHBpcmVzQXQuZ2V0RGF0ZSgpICsgNyk7IC8vIDcgZGF5cyBleHBpcmF0aW9uXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgcXVlcnlGbihcclxuICAgICAgICAnSU5TRVJUIElOVE8gc2Vzc2lvbnMgKHVzZXJfaWQsIHNlc3Npb25fdG9rZW4sIGV4cGlyZXNfYXQpIFZBTFVFUyAoJDEsICQyLCAkMyknLFxyXG4gICAgICAgIFt1c2VySWQsIHNlc3Npb25Ub2tlbiwgZXhwaXJlc0F0XVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHNlc3Npb25Ub2tlbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHNlc3Npb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG4gIC8vIFZlcmlmeSBhIHNlc3Npb24gdG9rZW4gLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIHZlcmlmeVNlc3Npb24oc2Vzc2lvblRva2VuKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygndmVyaWZ5U2Vzc2lvbiBjYWxsZWQgd2l0aCB0b2tlbicsIHsgXHJcbiAgICAgIHRva2VuTGVuZ3RoOiBzZXNzaW9uVG9rZW4gPyBzZXNzaW9uVG9rZW4ubGVuZ3RoIDogMCxcclxuICAgICAgdG9rZW5QcmVmaXg6IHNlc3Npb25Ub2tlbiA/IHNlc3Npb25Ub2tlbi5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJyA6ICdub25lJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVlcnlGbihcclxuICAgICAgICBgU0VMRUNUIHUuKiwgcy5zZXNzaW9uX2lkLCBzLmV4cGlyZXNfYXQsIGEuYWNjb3VudF9uYW1lLCBhLmlzX2FjdGl2ZSBhcyBhY2NvdW50X2lzX2FjdGl2ZSwgci5yb2xlX25hbWUsIHIucGVybWlzc2lvbnNcclxuICAgICAgICAgRlJPTSBzZXNzaW9ucyBzXHJcbiAgICAgICAgIEpPSU4gdXNlcnMgdSBPTiBzLnVzZXJfaWQgPSB1LnVzZXJfaWRcclxuICAgICAgICAgSk9JTiBhY2NvdW50cyBhIE9OIHUuYWNjb3VudF9pZCA9IGEuYWNjb3VudF9pZFxyXG4gICAgICAgICBKT0lOIHJvbGVzIHIgT04gdS5yb2xlX2lkID0gci5yb2xlX2lkXHJcbiAgICAgICAgIFdIRVJFIHMuc2Vzc2lvbl90b2tlbiA9ICQxIEFORCBzLmV4cGlyZXNfYXQgPiBOT1coKWAsXHJcbiAgICAgICAgW3Nlc3Npb25Ub2tlbl1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCd2ZXJpZnlTZXNzaW9uIHF1ZXJ5IHJlc3VsdCcsIHtcclxuICAgICAgICBmb3VuZDogcmVzdWx0LnJvd0NvdW50ID4gMCxcclxuICAgICAgICB1c2VyRGF0YTogcmVzdWx0LnJvd0NvdW50ID4gMCA/IHtcclxuICAgICAgICAgIHVzZXJfaWQ6IHJlc3VsdC5yb3dzWzBdLnVzZXJfaWQsXHJcbiAgICAgICAgICBlbWFpbDogcmVzdWx0LnJvd3NbMF0uZW1haWwsXHJcbiAgICAgICAgICBhY2NvdW50X2lkOiByZXN1bHQucm93c1swXS5hY2NvdW50X2lkLFxyXG4gICAgICAgICAgaXNfYWNjb3VudF9hZG1pbjogcmVzdWx0LnJvd3NbMF0uaXNfYWNjb3VudF9hZG1pbixcclxuICAgICAgICAgIGFjY291bnRfbmFtZTogcmVzdWx0LnJvd3NbMF0uYWNjb3VudF9uYW1lLFxyXG4gICAgICAgICAgcm9sZV9uYW1lOiByZXN1bHQucm93c1swXS5yb2xlX25hbWVcclxuICAgICAgICB9IDogbnVsbFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFkZCBzdGFuZGFyZCBwcm9wZXJ0eSBuYW1lcyBmb3IgY29uc2lzdGVuY3lcclxuICAgICAgaWYgKHJlc3VsdC5yb3dDb3VudCA+IDApIHtcclxuICAgICAgICBjb25zdCB1c2VyID0gcmVzdWx0LnJvd3NbMF07XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTWFwIGRhdGFiYXNlIGZpZWxkIG5hbWVzIHRvIHRoZSBjYW1lbENhc2UgZm9ybWF0IGV4cGVjdGVkIGJ5IGZyb250ZW5kXHJcbiAgICAgICAgdXNlci5pZCA9IHVzZXIudXNlcl9pZDtcclxuICAgICAgICB1c2VyLmZpcnN0TmFtZSA9IHVzZXIuZmlyc3RfbmFtZTtcclxuICAgICAgICB1c2VyLmxhc3ROYW1lID0gdXNlci5sYXN0X25hbWU7XHJcbiAgICAgICAgdXNlci5hY2NvdW50SWQgPSB1c2VyLmFjY291bnRfaWQ7XHJcbiAgICAgICAgdXNlci5pc0FkbWluID0gdXNlci5pc19hY2NvdW50X2FkbWluO1xyXG4gICAgICAgIHVzZXIuYWNjb3VudE5hbWUgPSB1c2VyLmFjY291bnRfbmFtZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB2ZXJpZnlpbmcgc2Vzc2lvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIEludmFsaWRhdGUgYSBzZXNzaW9uIC0gc2VydmVyIG9ubHlcclxuICBhc3luYyBpbnZhbGlkYXRlU2Vzc2lvbihzZXNzaW9uVG9rZW4pIHtcclxuICAgIC8vIEVuc3VyZSB3ZSdyZSBydW5uaW5nIG9uIHRoZSBzZXJ2ZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIHRoZSBzZXJ2ZXIgc2lkZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oJ0RFTEVURSBGUk9NIHNlc3Npb25zIFdIRVJFIHNlc3Npb25fdG9rZW4gPSAkMScsIFtzZXNzaW9uVG9rZW5dKTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbnZhbGlkYXRpbmcgc2Vzc2lvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIENyZWF0ZSBhIHBhc3N3b3JkIHJlc2V0IHRva2VuIC0gc2VydmVyIG9ubHlcclxuICBhc3luYyBjcmVhdGVQYXNzd29yZFJlc2V0VG9rZW4odXNlcklkKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b2tlbiA9IHV1aWR2NCgpO1xyXG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoKTtcclxuICAgIGV4cGlyZXNBdC5zZXRIb3VycyhleHBpcmVzQXQuZ2V0SG91cnMoKSArIDI0KTsgLy8gMjQgaG91cnMgZXhwaXJhdGlvblxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgJ0lOU0VSVCBJTlRPIHBhc3N3b3JkX3Jlc2V0X3Rva2VucyAodXNlcl9pZCwgdG9rZW4sIGV4cGlyZXNfYXQpIFZBTFVFUyAoJDEsICQyLCAkMyknLFxyXG4gICAgICAgIFt1c2VySWQsIHRva2VuLCBleHBpcmVzQXRdXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4gdG9rZW47XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBwYXNzd29yZCByZXNldCB0b2tlbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIFZlcmlmeSBhIHBhc3N3b3JkIHJlc2V0IHRva2VuIC0gc2VydmVyIG9ubHlcclxuICBhc3luYyB2ZXJpZnlSZXNldFRva2VuKHRva2VuKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeUZuKFxyXG4gICAgICAgICdTRUxFQ1QgKiBGUk9NIHBhc3N3b3JkX3Jlc2V0X3Rva2VucyBXSEVSRSB0b2tlbiA9ICQxIEFORCBleHBpcmVzX2F0ID4gTk9XKCknLFxyXG4gICAgICAgIFt0b2tlbl1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdmVyaWZ5aW5nIHJlc2V0IHRva2VuOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLy8gUmVzZXQgcGFzc3dvcmQgLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIHJlc2V0UGFzc3dvcmQodG9rZW4sIG5ld1Bhc3N3b3JkKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0b2tlblJlY29yZCA9IGF3YWl0IHRoaXMudmVyaWZ5UmVzZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICBpZiAoIXRva2VuUmVjb3JkKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBwYXNzd29yZEhhc2ggPSBhd2FpdCB0aGlzLmhhc2hQYXNzd29yZChuZXdQYXNzd29yZCk7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgcGFzc3dvcmRcclxuICAgICAgYXdhaXQgcXVlcnlGbihcclxuICAgICAgICAnVVBEQVRFIHVzZXJzIFNFVCBwYXNzd29yZF9oYXNoID0gJDEsIHVwZGF0ZWRfYXQgPSBOT1coKSBXSEVSRSB1c2VyX2lkID0gJDInLFxyXG4gICAgICAgIFtwYXNzd29yZEhhc2gsIHRva2VuUmVjb3JkLnVzZXJfaWRdXHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBEZWxldGUgdGhlIHRva2VuXHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oJ0RFTEVURSBGUk9NIHBhc3N3b3JkX3Jlc2V0X3Rva2VucyBXSEVSRSB0b2tlbl9pZCA9ICQxJywgW3Rva2VuUmVjb3JkLnRva2VuX2lkXSk7XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZXNldHRpbmcgcGFzc3dvcmQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblxyXG4vLyBBY2NvdW50IG1hbmFnZW1lbnQgLSBhbGwgbWV0aG9kcyBhcmUgc2VydmVyLW9ubHlcclxuZXhwb3J0IGNvbnN0IGFjY291bnRNYW5hZ2VyID0ge1xyXG4gIC8vIENyZWF0ZSBhIG5ldyBhY2NvdW50IHdpdGggYWRtaW4gdXNlclxyXG4gIGFzeW5jIGNyZWF0ZUFjY291bnQoYWNjb3VudERhdGEsIHVzZXJEYXRhKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBTdGFydCBhIHRyYW5zYWN0aW9uXHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oJ0JFR0lOJyk7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgYWNjb3VudFxyXG4gICAgICBjb25zdCBhY2NvdW50UmVzdWx0ID0gYXdhaXQgcXVlcnlGbihcclxuICAgICAgICAnSU5TRVJUIElOVE8gYWNjb3VudHMgKGFjY291bnRfbmFtZSwgYWNjb3VudF9kb21haW4sIHBsYW5faWQsIGJpbGxpbmdfZW1haWwpIFZBTFVFUyAoJDEsICQyLCAkMywgJDQpIFJFVFVSTklORyAqJyxcclxuICAgICAgICBbYWNjb3VudERhdGEuYWNjb3VudE5hbWUsIGFjY291bnREYXRhLmFjY291bnREb21haW4gfHwgbnVsbCwgYWNjb3VudERhdGEucGxhbklkIHx8IDEsIGFjY291bnREYXRhLmJpbGxpbmdFbWFpbF1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IGFjY291bnQgPSBhY2NvdW50UmVzdWx0LnJvd3NbMF07XHJcblxyXG4gICAgICAvLyBIYXNoIHBhc3N3b3JkXHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkSGFzaCA9IGF3YWl0IGF1dGguaGFzaFBhc3N3b3JkKHVzZXJEYXRhLnBhc3N3b3JkKTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhZG1pbiB1c2VyIChyb2xlX2lkIDEgPSBBZG1pbilcclxuICAgICAgY29uc3QgdXNlclJlc3VsdCA9IGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgYElOU0VSVCBJTlRPIHVzZXJzIChhY2NvdW50X2lkLCBlbWFpbCwgcGFzc3dvcmRfaGFzaCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCByb2xlX2lkLCBpc19hY2NvdW50X2FkbWluKSBcclxuICAgICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsIDEsIFRSVUUpIFJFVFVSTklORyAqYCxcclxuICAgICAgICBbYWNjb3VudC5hY2NvdW50X2lkLCB1c2VyRGF0YS5lbWFpbCwgcGFzc3dvcmRIYXNoLCB1c2VyRGF0YS5maXJzdE5hbWUsIHVzZXJEYXRhLmxhc3ROYW1lXVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3QgYWRtaW4gPSB1c2VyUmVzdWx0LnJvd3NbMF07XHJcblxyXG4gICAgICAvLyBDb21taXQgdHJhbnNhY3Rpb25cclxuICAgICAgYXdhaXQgcXVlcnlGbignQ09NTUlUJyk7XHJcblxyXG4gICAgICByZXR1cm4geyBhY2NvdW50LCBhZG1pbiB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8gUm9sbGJhY2sgdHJhbnNhY3Rpb24gb24gZXJyb3JcclxuICAgICAgYXdhaXQgcXVlcnlGbignUk9MTEJBQ0snKTtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgYWNjb3VudDonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIFJlbWFpbmluZyBhY2NvdW50IG1hbmFnZXIgbWV0aG9kcyAodHJ1bmNhdGVkIGZvciBicmV2aXR5KVxyXG4gIC8vIFRoZSBwYXR0ZXJuIHdvdWxkIGJlIHRoZSBzYW1lIC0gdXNpbmcgcXVlcnlGbiBhbmQgcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbn07XHJcblxyXG4vLyBDcmVhdGUgbW9jayBpbXBsZW1lbnRhdGlvbnMgZm9yIGNsaWVudC1zaWRlIHVzZVxyXG5jb25zdCBjcmVhdGVNb2NrQXV0aCA9ICgpID0+IHtcclxuICBjb25zdCBtb2NrQXV0aCA9IHtcclxuICAgIC8vIE1vY2sgaW1wbGVtZW50YXRpb25zIHRoYXQgYXJlIHNhZmUgdG8gdXNlIG9uIHRoZSBjbGllbnRcclxuICAgIGFzeW5jIGhhc2hQYXNzd29yZChwYXNzd29yZCkge1xyXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAvLyBXaGVuIHJ1bm5pbmcgb24gdGhlIHNlcnZlciwgdXNlIHRoZSByZWFsIGltcGxlbWVudGF0aW9uXHJcbiAgICAgICAgcmV0dXJuIGF1dGguaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gT24gY2xpZW50LCBqdXN0IHJldHVybiBhIHBsYWNlaG9sZGVyIChyZWFsIGhhc2hpbmcgaGFwcGVucyBzZXJ2ZXItc2lkZSlcclxuICAgICAgY29uc29sZS53YXJuKCdoYXNoUGFzc3dvcmQgY2FsbGVkIG9uIGNsaWVudCwgcmVhbCBoYXNoaW5nIHdpbGwgaGFwcGVuIHNlcnZlci1zaWRlJyk7XHJcbiAgICAgIHJldHVybiBgbW9jay1oYXNoLSR7cGFzc3dvcmQubGVuZ3RofWA7XHJcbiAgICB9LFxyXG5cclxuICAgIGFzeW5jIGNvbXBhcmVQYXNzd29yZChwYXNzd29yZCwgaGFzaCkge1xyXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAvLyBXaGVuIHJ1bm5pbmcgb24gdGhlIHNlcnZlciwgdXNlIHRoZSByZWFsIGltcGxlbWVudGF0aW9uXHJcbiAgICAgICAgcmV0dXJuIGF1dGguY29tcGFyZVBhc3N3b3JkKHBhc3N3b3JkLCBoYXNoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gT24gY2xpZW50LCBqdXN0IHJldHVybiBhIHBsYWNlaG9sZGVyIChyZWFsIGNvbXBhcmlzb24gaGFwcGVucyBzZXJ2ZXItc2lkZSlcclxuICAgICAgY29uc29sZS53YXJuKCdjb21wYXJlUGFzc3dvcmQgY2FsbGVkIG9uIGNsaWVudCwgcmVhbCBjb21wYXJpc29uIHdpbGwgaGFwcGVuIHNlcnZlci1zaWRlJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0sXHJcblxyXG4gICAgLy8gVGhlc2UgbWV0aG9kcyBzaG91bGQgYmUgY2FsbGVkIHZpYSBBUEkgZW5kcG9pbnRzIG9uIHRoZSBjbGllbnRcclxuICAgIGFzeW5jIGZpbmRVc2VyQnlFbWFpbCgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgZmluZFVzZXJCeUlkKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyBjcmVhdGVTZXNzaW9uKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyB2ZXJpZnlTZXNzaW9uKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyBpbnZhbGlkYXRlU2Vzc2lvbigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgY3JlYXRlUGFzc3dvcmRSZXNldFRva2VuKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyB2ZXJpZnlSZXNldFRva2VuKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyByZXNldFBhc3N3b3JkKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJldHVybiBtb2NrQXV0aDtcclxufTtcclxuXHJcbi8vIENyZWF0ZSBhIG1vY2sgYWNjb3VudCBtYW5hZ2VyIGZvciBjbGllbnQtc2lkZSB1c2VcclxuY29uc3QgY3JlYXRlTW9ja0FjY291bnRNYW5hZ2VyID0gKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tBY2NvdW50TWFuYWdlciA9IHtcclxuICAgIC8vIEFsbCBtZXRob2RzIHNob3VsZCBiZSBjYWxsZWQgdmlhIEFQSSBlbmRwb2ludHMgb24gdGhlIGNsaWVudFxyXG4gICAgYXN5bmMgY3JlYXRlQWNjb3VudCgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgZ2V0QWNjb3VudFVzZXJzKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyBjcmVhdGVVc2VyKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyB1cGRhdGVVc2VyKCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyB1cGRhdGVBY2NvdW50KCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgdmlhIGFuIEFQSSBlbmRwb2ludCBvbiBjbGllbnQtc2lkZScpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJldHVybiBtb2NrQWNjb3VudE1hbmFnZXI7XHJcbn07XHJcblxyXG4vLyBFeHBvcnQgdGhlIGFwcHJvcHJpYXRlIGltcGxlbWVudGF0aW9ucyBiYXNlZCBvbiBlbnZpcm9ubWVudFxyXG5leHBvcnQgY29uc3QgY2xpZW50QXV0aCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gY3JlYXRlTW9ja0F1dGgoKSA6IGF1dGg7XHJcbmV4cG9ydCBjb25zdCBjbGllbnRBY2NvdW50TWFuYWdlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gY3JlYXRlTW9ja0FjY291bnRNYW5hZ2VyKCkgOiBhY2NvdW50TWFuYWdlcjsiXSwibmFtZXMiOlsiYmNyeXB0IiwidXVpZHY0IiwicXVlcnlGbiIsInBvb2xPYmoiLCJyZXF1aXJlIiwidjQiLCJkYk1vZHVsZSIsInF1ZXJ5IiwicG9vbCIsImVycm9yIiwiY29uc29sZSIsImhhc2giLCJjb21wYXJlIiwiRXJyb3IiLCJhdXRoIiwiaGFzaFBhc3N3b3JkIiwicGFzc3dvcmQiLCJ3YXJuIiwibGVuZ3RoIiwiY29tcGFyZVBhc3N3b3JkIiwiZmluZFVzZXJCeUVtYWlsIiwiZW1haWwiLCJyZXN1bHQiLCJyb3dzIiwiZmluZFVzZXJCeUlkIiwidXNlcklkIiwiY3JlYXRlU2Vzc2lvbiIsInNlc3Npb25Ub2tlbiIsImV4cGlyZXNBdCIsIkRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInZlcmlmeVNlc3Npb24iLCJsb2ciLCJ0b2tlbkxlbmd0aCIsInRva2VuUHJlZml4Iiwic3Vic3RyaW5nIiwiZm91bmQiLCJyb3dDb3VudCIsInVzZXJEYXRhIiwidXNlcl9pZCIsImFjY291bnRfaWQiLCJpc19hY2NvdW50X2FkbWluIiwiYWNjb3VudF9uYW1lIiwicm9sZV9uYW1lIiwidXNlciIsImlkIiwiZmlyc3ROYW1lIiwiZmlyc3RfbmFtZSIsImxhc3ROYW1lIiwibGFzdF9uYW1lIiwiYWNjb3VudElkIiwiaXNBZG1pbiIsImFjY291bnROYW1lIiwiaW52YWxpZGF0ZVNlc3Npb24iLCJjcmVhdGVQYXNzd29yZFJlc2V0VG9rZW4iLCJ0b2tlbiIsInNldEhvdXJzIiwiZ2V0SG91cnMiLCJ2ZXJpZnlSZXNldFRva2VuIiwicmVzZXRQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidG9rZW5SZWNvcmQiLCJzdWNjZXNzIiwicGFzc3dvcmRIYXNoIiwidG9rZW5faWQiLCJhY2NvdW50TWFuYWdlciIsImNyZWF0ZUFjY291bnQiLCJhY2NvdW50RGF0YSIsImFjY291bnRSZXN1bHQiLCJhY2NvdW50RG9tYWluIiwicGxhbklkIiwiYmlsbGluZ0VtYWlsIiwiYWNjb3VudCIsInVzZXJSZXN1bHQiLCJhZG1pbiIsImNyZWF0ZU1vY2tBdXRoIiwibW9ja0F1dGgiLCJjcmVhdGVNb2NrQWNjb3VudE1hbmFnZXIiLCJtb2NrQWNjb3VudE1hbmFnZXIiLCJnZXRBY2NvdW50VXNlcnMiLCJjcmVhdGVVc2VyIiwidXBkYXRlVXNlciIsInVwZGF0ZUFjY291bnQiLCJjbGllbnRBdXRoIiwiY2xpZW50QWNjb3VudE1hbmFnZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pool: () => (/* binding */ pool),\n/* harmony export */   query: () => (/* binding */ query)\n/* harmony export */ });\n// lib/db.js\n// Initialize query and pool as null\nlet pool = null;\nlet query = null;\n// Only run this code on the server\nif (true) {\n    try {\n        // Server-side code - import pg using require to avoid webpack issues\n        const { Pool } = __webpack_require__(/*! pg */ \"pg\");\n        // Create a database connection pool\n        pool =  false ? 0 : new Pool({\n            user: process.env.DB_USER || 'postgres',\n            host: process.env.DB_HOST || 'localhost',\n            database: process.env.DB_NAME || 'innvestai',\n            password: process.env.DB_PASSWORD || 'Temp@123',\n            port: parseInt(process.env.DB_PORT || '5432')\n        });\n        // Define the query function\n        query = async (text, params)=>{\n            try {\n                const start = Date.now();\n                const res = await pool.query(text, params);\n                const duration = Date.now() - start;\n                // Log query performance in development\n                if (true) {\n                    console.log('Executed query', {\n                        text,\n                        duration,\n                        rows: res.rowCount\n                    });\n                }\n                return res;\n            } catch (error) {\n                console.error('Database query error:', error);\n                throw error;\n            }\n        };\n        // Setup event handlers for the pool\n        pool.on('error', (err)=>{\n            console.error('Unexpected database error:', err);\n        // Don't crash the server on connection errors\n        });\n        console.log('Database module initialized on server');\n    } catch (error) {\n        console.error('Failed to initialize database module:', error);\n        // Create non-functional stubs if initialization fails\n        pool = {\n            query: ()=>{\n                throw new Error('Database pool not initialized');\n            },\n            on: ()=>{}\n        };\n        query = async ()=>{\n            throw new Error('Database query function not initialized');\n        };\n    }\n} else {}\n// Next.js supports ES modules by default\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLFlBQVk7QUFFWixvQ0FBb0M7QUFDcEMsSUFBSUEsT0FBTztBQUNYLElBQUlDLFFBQVE7QUFFWixtQ0FBbUM7QUFDbkMsSUFBSSxJQUE2QixFQUFFO0lBQ2pDLElBQUk7UUFDRixxRUFBcUU7UUFDckUsTUFBTSxFQUFFQyxJQUFJLEVBQUUsR0FBR0MsbUJBQU9BLENBQUMsY0FBSTtRQUU3QixvQ0FBb0M7UUFDcENILE9BQU9JLE1BQXFDLEdBQ3hDLENBS0UsR0FDRixJQUFJRixLQUFLO1lBQ1BRLE1BQU1OLFFBQVFFLEdBQUcsQ0FBQ0ssT0FBTyxJQUFJO1lBQzdCQyxNQUFNUixRQUFRRSxHQUFHLENBQUNPLE9BQU8sSUFBSTtZQUM3QkMsVUFBVVYsUUFBUUUsR0FBRyxDQUFDUyxPQUFPLElBQUk7WUFDakNDLFVBQVVaLFFBQVFFLEdBQUcsQ0FBQ1csV0FBVyxJQUFJO1lBQ3JDQyxNQUFNQyxTQUFTZixRQUFRRSxHQUFHLENBQUNjLE9BQU8sSUFBSTtRQUN4QztRQUVKLDRCQUE0QjtRQUM1Qm5CLFFBQVEsT0FBT29CLE1BQU1DO1lBQ25CLElBQUk7Z0JBQ0YsTUFBTUMsUUFBUUMsS0FBS0MsR0FBRztnQkFDdEIsTUFBTUMsTUFBTSxNQUFNMUIsS0FBS0MsS0FBSyxDQUFDb0IsTUFBTUM7Z0JBQ25DLE1BQU1LLFdBQVdILEtBQUtDLEdBQUcsS0FBS0Y7Z0JBRTlCLHVDQUF1QztnQkFDdkMsSUFBSW5CLElBQXFDLEVBQUU7b0JBQ3pDd0IsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjt3QkFBRVI7d0JBQU1NO3dCQUFVRyxNQUFNSixJQUFJSyxRQUFRO29CQUFDO2dCQUNyRTtnQkFFQSxPQUFPTDtZQUNULEVBQUUsT0FBT00sT0FBTztnQkFDZEosUUFBUUksS0FBSyxDQUFDLHlCQUF5QkE7Z0JBQ3ZDLE1BQU1BO1lBQ1I7UUFDRjtRQUVBLG9DQUFvQztRQUNwQ2hDLEtBQUtpQyxFQUFFLENBQUMsU0FBUyxDQUFDQztZQUNoQk4sUUFBUUksS0FBSyxDQUFDLDhCQUE4QkU7UUFDNUMsOENBQThDO1FBQ2hEO1FBRUFOLFFBQVFDLEdBQUcsQ0FBQztJQUNkLEVBQUUsT0FBT0csT0FBTztRQUNkSixRQUFRSSxLQUFLLENBQUMseUNBQXlDQTtRQUV2RCxzREFBc0Q7UUFDdERoQyxPQUFPO1lBQ0xDLE9BQU87Z0JBQVEsTUFBTSxJQUFJa0MsTUFBTTtZQUFrQztZQUNqRUYsSUFBSSxLQUFPO1FBQ2I7UUFFQWhDLFFBQVE7WUFBYyxNQUFNLElBQUlrQyxNQUFNO1FBQTRDO0lBQ3BGO0FBQ0YsT0FBTyxFQVlOO0FBRUQseUNBQXlDO0FBQ2xCIiwic291cmNlcyI6WyJDOlxcdmlub2RcXHByb2plY3RzXFxpbm52ZXN0XFxQT0NcXGlubnZlc3RhaVxcbGliXFxkYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvZGIuanNcclxuXHJcbi8vIEluaXRpYWxpemUgcXVlcnkgYW5kIHBvb2wgYXMgbnVsbFxyXG5sZXQgcG9vbCA9IG51bGw7XHJcbmxldCBxdWVyeSA9IG51bGw7XHJcblxyXG4vLyBPbmx5IHJ1biB0aGlzIGNvZGUgb24gdGhlIHNlcnZlclxyXG5pZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICB0cnkge1xyXG4gICAgLy8gU2VydmVyLXNpZGUgY29kZSAtIGltcG9ydCBwZyB1c2luZyByZXF1aXJlIHRvIGF2b2lkIHdlYnBhY2sgaXNzdWVzXHJcbiAgICBjb25zdCB7IFBvb2wgfSA9IHJlcXVpcmUoJ3BnJyk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgZGF0YWJhc2UgY29ubmVjdGlvbiBwb29sXHJcbiAgICBwb29sID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyBcclxuICAgICAgPyBuZXcgUG9vbCh7XHJcbiAgICAgICAgICBjb25uZWN0aW9uU3RyaW5nOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXHJcbiAgICAgICAgICBzc2w6IHtcclxuICAgICAgICAgICAgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIDogbmV3IFBvb2woe1xyXG4gICAgICAgICAgdXNlcjogcHJvY2Vzcy5lbnYuREJfVVNFUiB8fCAncG9zdGdyZXMnLFxyXG4gICAgICAgICAgaG9zdDogcHJvY2Vzcy5lbnYuREJfSE9TVCB8fCAnbG9jYWxob3N0JyxcclxuICAgICAgICAgIGRhdGFiYXNlOiBwcm9jZXNzLmVudi5EQl9OQU1FIHx8ICdpbm52ZXN0YWknLCAvLyBVc2UgYnVpbHQtaW4gcG9zdGdyZXMgZGF0YWJhc2VcclxuICAgICAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5EQl9QQVNTV09SRCB8fCAnVGVtcEAxMjMnLFxyXG4gICAgICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREJfUE9SVCB8fCAnNTQzMicpLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIC8vIERlZmluZSB0aGUgcXVlcnkgZnVuY3Rpb25cclxuICAgIHF1ZXJ5ID0gYXN5bmMgKHRleHQsIHBhcmFtcykgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBwb29sLnF1ZXJ5KHRleHQsIHBhcmFtcyk7XHJcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTG9nIHF1ZXJ5IHBlcmZvcm1hbmNlIGluIGRldmVsb3BtZW50XHJcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdFeGVjdXRlZCBxdWVyeScsIHsgdGV4dCwgZHVyYXRpb24sIHJvd3M6IHJlcy5yb3dDb3VudCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBxdWVyeSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gU2V0dXAgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBwb29sXHJcbiAgICBwb29sLm9uKCdlcnJvcicsIChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBkYXRhYmFzZSBlcnJvcjonLCBlcnIpO1xyXG4gICAgICAvLyBEb24ndCBjcmFzaCB0aGUgc2VydmVyIG9uIGNvbm5lY3Rpb24gZXJyb3JzXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnRGF0YWJhc2UgbW9kdWxlIGluaXRpYWxpemVkIG9uIHNlcnZlcicpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkYXRhYmFzZSBtb2R1bGU6JywgZXJyb3IpO1xyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgbm9uLWZ1bmN0aW9uYWwgc3R1YnMgaWYgaW5pdGlhbGl6YXRpb24gZmFpbHNcclxuICAgIHBvb2wgPSB7XHJcbiAgICAgIHF1ZXJ5OiAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcG9vbCBub3QgaW5pdGlhbGl6ZWQnKTsgfSxcclxuICAgICAgb246ICgpID0+IHt9XHJcbiAgICB9O1xyXG5cclxuICAgIHF1ZXJ5ID0gYXN5bmMgKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIHF1ZXJ5IGZ1bmN0aW9uIG5vdCBpbml0aWFsaXplZCcpOyB9O1xyXG4gIH1cclxufSBlbHNlIHtcclxuICAvLyBDbGllbnQtc2lkZSBtb2NrIGltcGxlbWVudGF0aW9uXHJcbiAgcXVlcnkgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIHF1ZXJpZXMgY2Fubm90IGJlIGV4ZWN1dGVkIG9uIHRoZSBjbGllbnQgc2lkZScpO1xyXG4gIH07XHJcbiAgXHJcbiAgcG9vbCA9IHtcclxuICAgIHF1ZXJ5OiAoKSA9PiB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcmllcyBjYW5ub3QgYmUgZXhlY3V0ZWQgb24gdGhlIGNsaWVudCBzaWRlJyk7XHJcbiAgICB9LFxyXG4gICAgb246ICgpID0+IHt9XHJcbiAgfTtcclxufVxyXG5cclxuLy8gTmV4dC5qcyBzdXBwb3J0cyBFUyBtb2R1bGVzIGJ5IGRlZmF1bHRcclxuZXhwb3J0IHsgcXVlcnksIHBvb2wgfTsiXSwibmFtZXMiOlsicG9vbCIsInF1ZXJ5IiwiUG9vbCIsInJlcXVpcmUiLCJwcm9jZXNzIiwiY29ubmVjdGlvblN0cmluZyIsImVudiIsIkRBVEFCQVNFX1VSTCIsInNzbCIsInJlamVjdFVuYXV0aG9yaXplZCIsInVzZXIiLCJEQl9VU0VSIiwiaG9zdCIsIkRCX0hPU1QiLCJkYXRhYmFzZSIsIkRCX05BTUUiLCJwYXNzd29yZCIsIkRCX1BBU1NXT1JEIiwicG9ydCIsInBhcnNlSW50IiwiREJfUE9SVCIsInRleHQiLCJwYXJhbXMiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJyZXMiLCJkdXJhdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJyb3dzIiwicm93Q291bnQiLCJlcnJvciIsIm9uIiwiZXJyIiwiRXJyb3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./middleware/auth.js":
/*!****************************!*\
  !*** ./middleware/auth.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   apiAuthMiddleware: () => (/* binding */ apiAuthMiddleware),\n/* harmony export */   authMiddleware: () => (/* binding */ authMiddleware),\n/* harmony export */   getAuthenticatedUser: () => (/* binding */ getAuthenticatedUser),\n/* harmony export */   isAuthenticated: () => (/* binding */ isAuthenticated),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withAuthRedirect: () => (/* binding */ withAuthRedirect),\n/* harmony export */   withPermission: () => (/* binding */ withPermission)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(api-node)/./node_modules/next/server.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_server__WEBPACK_IMPORTED_MODULE_0__);\n// middleware/auth.js\n\n// This middleware runs on the server (Edge runtime)\nasync function authMiddleware(req) {\n    const { pathname } = req.nextUrl;\n    // Public paths that don't require authentication\n    const publicPaths = [\n        '/login',\n        '/signup',\n        '/reset-password',\n        '/api/auth/login',\n        '/api/auth/signup',\n        '/api/auth/reset-password',\n        '/api/debug'\n    ];\n    // Check if the path is public\n    const isPublicPath = publicPaths.some((path)=>pathname === path || pathname.startsWith(path + '/'));\n    // Allow access to public paths\n    if (isPublicPath) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Get the session token from cookies\n    const sessionToken = req.cookies.get('session_token')?.value;\n    // If no session token, redirect to login\n    if (!sessionToken) {\n        const url = new URL('/login', req.url);\n        url.searchParams.set('redirect', pathname);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    // Note: We can't verify the session here since Edge runtime doesn't support database connections\n    // We'll rely on API routes to verify the session on each request that needs it\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\n// This is used client-side to check if user is authenticated\nasync function isAuthenticated() {\n    // This only runs in the browser\n    if (true) {\n        return false;\n    }\n    // Check for session token cookie\n    const cookies = document.cookie.split(';').reduce((acc, cookie)=>{\n        const [key, value] = cookie.trim().split('=');\n        acc[key] = value;\n        return acc;\n    }, {});\n    return !!cookies.session_token;\n}\n// This is only used server-side in API routes and server components\nconst apiAuthMiddleware = async (req, res, next)=>{\n    console.log('apiAuthMiddleware called', {\n        url: req.url,\n        method: req.method,\n        query: req.query\n    });\n    // Only run this on the server\n    if (false) {}\n    // Get the session token from cookies\n    const cookies = req.cookies;\n    const sessionToken = cookies.session_token;\n    console.log('Session token check', {\n        hasToken: !!sessionToken,\n        cookiesReceived: Object.keys(cookies)\n    });\n    // If no session token, return unauthorized\n    if (!sessionToken) {\n        console.log('No session token found, authentication required');\n        return res.status(401).json({\n            error: 'Authentication required'\n        });\n    }\n    try {\n        console.log('Verifying session token');\n        // Import auth only on server-side\n        const { auth } = __webpack_require__(/*! ../lib/auth */ \"(api-node)/./lib/auth.js\");\n        // Verify the session\n        const user = await auth.verifySession(sessionToken);\n        console.log('Session verification result', {\n            hasUser: !!user,\n            userId: user?.id,\n            userEmail: user?.email\n        });\n        // If session is invalid, return unauthorized\n        if (!user) {\n            console.log('Invalid or expired session');\n            return res.status(401).json({\n                error: 'Invalid or expired session'\n            });\n        }\n        // Attach user to request object\n        req.user = user;\n        console.log('User authenticated successfully', {\n            id: user.id,\n            email: user.email,\n            accountId: user.accountId,\n            isAdmin: user.isAdmin || user.is_account_admin\n        });\n        // Continue to the next middleware or handler\n        if (next) {\n            return next();\n        }\n        return true;\n    } catch (error) {\n        console.error('Auth middleware error:', error);\n        return res.status(500).json({\n            error: 'Authentication error'\n        });\n    }\n};\n// For use in API routes to get the authenticated user\nconst getAuthenticatedUser = async (req, res)=>{\n    const isAuthenticated = await apiAuthMiddleware(req, res);\n    return isAuthenticated === true ? req.user : null;\n};\n// withAuth HOC for protecting API routes with authentication\nconst withAuth = (handler)=>{\n    return async (req, res)=>{\n        try {\n            // Check if user is authenticated\n            const result = await apiAuthMiddleware(req, res);\n            // If the middleware returned a status code, it handled unauthorized\n            if (result !== true) {\n                return result;\n            }\n            // User is authenticated, so execute the handler\n            return await handler(req, res);\n        } catch (error) {\n            console.error('Error in withAuth middleware:', error);\n            return res.status(500).json({\n                error: 'An internal server error occurred'\n            });\n        }\n    };\n};\n// withPermission HOC for protecting API routes that need specific permissions\nconst withPermission = (handler, permission)=>{\n    return async (req, res)=>{\n        try {\n            console.log(`withPermission middleware called for permission: ${permission}`);\n            // First check authentication\n            const authResult = await apiAuthMiddleware(req, res);\n            if (authResult !== true) {\n                console.log('Authentication failed in withPermission', {\n                    authResult\n                });\n                return authResult;\n            }\n            console.log('User authenticated in withPermission', {\n                userId: req.user?.id,\n                email: req.user?.email,\n                permissions: req.user?.permissions,\n                isAccountAdmin: req.user?.is_account_admin\n            });\n            // Check permission - allow access if:\n            // 1. The user has the specific permission, OR\n            // 2. The user has 'all' permissions, OR\n            // 3. The user is an account admin\n            // 4. If no specific permission is required (null/undefined)\n            const user = req.user;\n            const hasPermission = !permission || user.permissions && (user.permissions[permission] === true || user.permissions.all === true || user.is_account_admin === true);\n            if (!hasPermission) {\n                console.log('Permission denied in withPermission', {\n                    requiredPermission: permission,\n                    userPermissions: user.permissions,\n                    isAdmin: user.is_account_admin\n                });\n                return res.status(403).json({\n                    error: 'You do not have permission to access this resource'\n                });\n            }\n            console.log('Permission granted in withPermission', {\n                permission\n            });\n            // User is authenticated and has permission, so execute the handler\n            return await handler(req, res);\n        } catch (error) {\n            console.error('Error in withPermission middleware:', error);\n            return res.status(500).json({\n                error: 'An internal server error occurred'\n            });\n        }\n    };\n};\n// withAuthRedirect HOC for client-side auth checking with redirect\nconst withAuthRedirect = (Component, options = {\n    adminOnly: false\n})=>{\n    // This is just a wrapper around withAuthProtection for consistency\n    return Component;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUksQ0FBQztvQkFBRVAsT0FBTztnQkFBcUQ7WUFDNUY7WUFFQUosUUFBUUMsR0FBRyxDQUFDLHdDQUF3QztnQkFBRTRCO1lBQVc7WUFFakUsbUVBQW1FO1lBQ25FLE9BQU8sTUFBTUgsUUFBUXZELEtBQUs0QjtRQUM1QixFQUFFLE9BQU9LLE9BQU87WUFDZEosUUFBUUksS0FBSyxDQUFDLHVDQUF1Q0E7WUFDckQsT0FBT0wsSUFBSVcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRVAsT0FBTztZQUFvQztRQUMzRTtJQUNGO0FBQ0YsRUFBRTtBQUVGLG1FQUFtRTtBQUM1RCxNQUFNaUMsbUJBQW1CLENBQUNDLFdBQVdDLFVBQVU7SUFBRUMsV0FBVztBQUFNLENBQUM7SUFDeEUsbUVBQW1FO0lBQ25FLE9BQU9GO0FBQ1QsRUFBRSIsInNvdXJjZXMiOlsiQzpcXHZpbm9kXFxwcm9qZWN0c1xcaW5udmVzdFxcUE9DXFxpbm52ZXN0YWlcXG1pZGRsZXdhcmVcXGF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWlkZGxld2FyZS9hdXRoLmpzXHJcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuXHJcbi8vIFRoaXMgbWlkZGxld2FyZSBydW5zIG9uIHRoZSBzZXJ2ZXIgKEVkZ2UgcnVudGltZSlcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGF1dGhNaWRkbGV3YXJlKHJlcSkge1xyXG4gIGNvbnN0IHsgcGF0aG5hbWUgfSA9IHJlcS5uZXh0VXJsO1xyXG4gIFxyXG4gIC8vIFB1YmxpYyBwYXRocyB0aGF0IGRvbid0IHJlcXVpcmUgYXV0aGVudGljYXRpb25cclxuICBjb25zdCBwdWJsaWNQYXRocyA9IFtcclxuICAgICcvbG9naW4nLFxyXG4gICAgJy9zaWdudXAnLFxyXG4gICAgJy9yZXNldC1wYXNzd29yZCcsXHJcbiAgICAnL2FwaS9hdXRoL2xvZ2luJyxcclxuICAgICcvYXBpL2F1dGgvc2lnbnVwJyxcclxuICAgICcvYXBpL2F1dGgvcmVzZXQtcGFzc3dvcmQnLFxyXG4gICAgJy9hcGkvZGVidWcnLCAvLyBBZGQgZGVidWcgQVBJIHJvdXRlcyBhcyBwdWJsaWNcclxuICBdO1xyXG4gIFxyXG4gIC8vIENoZWNrIGlmIHRoZSBwYXRoIGlzIHB1YmxpY1xyXG4gIGNvbnN0IGlzUHVibGljUGF0aCA9IHB1YmxpY1BhdGhzLnNvbWUocGF0aCA9PiBcclxuICAgIHBhdGhuYW1lID09PSBwYXRoIHx8IHBhdGhuYW1lLnN0YXJ0c1dpdGgocGF0aCArICcvJylcclxuICApO1xyXG4gIFxyXG4gIC8vIEFsbG93IGFjY2VzcyB0byBwdWJsaWMgcGF0aHNcclxuICBpZiAoaXNQdWJsaWNQYXRoKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gR2V0IHRoZSBzZXNzaW9uIHRva2VuIGZyb20gY29va2llc1xyXG4gIGNvbnN0IHNlc3Npb25Ub2tlbiA9IHJlcS5jb29raWVzLmdldCgnc2Vzc2lvbl90b2tlbicpPy52YWx1ZTtcclxuICBcclxuICAvLyBJZiBubyBzZXNzaW9uIHRva2VuLCByZWRpcmVjdCB0byBsb2dpblxyXG4gIGlmICghc2Vzc2lvblRva2VuKSB7XHJcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKCcvbG9naW4nLCByZXEudXJsKTtcclxuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZWRpcmVjdCcsIHBhdGhuYW1lKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gTm90ZTogV2UgY2FuJ3QgdmVyaWZ5IHRoZSBzZXNzaW9uIGhlcmUgc2luY2UgRWRnZSBydW50aW1lIGRvZXNuJ3Qgc3VwcG9ydCBkYXRhYmFzZSBjb25uZWN0aW9uc1xyXG4gIC8vIFdlJ2xsIHJlbHkgb24gQVBJIHJvdXRlcyB0byB2ZXJpZnkgdGhlIHNlc3Npb24gb24gZWFjaCByZXF1ZXN0IHRoYXQgbmVlZHMgaXRcclxuICBcclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxufVxyXG5cclxuLy8gVGhpcyBpcyB1c2VkIGNsaWVudC1zaWRlIHRvIGNoZWNrIGlmIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNBdXRoZW50aWNhdGVkKCkge1xyXG4gIC8vIFRoaXMgb25seSBydW5zIGluIHRoZSBicm93c2VyXHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIENoZWNrIGZvciBzZXNzaW9uIHRva2VuIGNvb2tpZVxyXG4gIGNvbnN0IGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKS5yZWR1Y2UoKGFjYywgY29va2llKSA9PiB7XHJcbiAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBjb29raWUudHJpbSgpLnNwbGl0KCc9Jyk7XHJcbiAgICBhY2Nba2V5XSA9IHZhbHVlO1xyXG4gICAgcmV0dXJuIGFjYztcclxuICB9LCB7fSk7XHJcbiAgXHJcbiAgcmV0dXJuICEhY29va2llcy5zZXNzaW9uX3Rva2VuO1xyXG59XHJcblxyXG4vLyBUaGlzIGlzIG9ubHkgdXNlZCBzZXJ2ZXItc2lkZSBpbiBBUEkgcm91dGVzIGFuZCBzZXJ2ZXIgY29tcG9uZW50c1xyXG5leHBvcnQgY29uc3QgYXBpQXV0aE1pZGRsZXdhcmUgPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBjb25zb2xlLmxvZygnYXBpQXV0aE1pZGRsZXdhcmUgY2FsbGVkJywgeyBcclxuICAgIHVybDogcmVxLnVybCxcclxuICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcclxuICAgIHF1ZXJ5OiByZXEucXVlcnkgXHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gT25seSBydW4gdGhpcyBvbiB0aGUgc2VydmVyXHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdhcGlBdXRoTWlkZGxld2FyZSBjYWxsZWQgb24gY2xpZW50IHNpZGUnKTtcclxuICAgIHRocm93IG5ldyBFcnJvcignYXBpQXV0aE1pZGRsZXdhcmUgY2FuIG9ubHkgYmUgdXNlZCBvbiB0aGUgc2VydmVyJyk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIEdldCB0aGUgc2Vzc2lvbiB0b2tlbiBmcm9tIGNvb2tpZXNcclxuICBjb25zdCBjb29raWVzID0gcmVxLmNvb2tpZXM7XHJcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gY29va2llcy5zZXNzaW9uX3Rva2VuO1xyXG4gIFxyXG4gIGNvbnNvbGUubG9nKCdTZXNzaW9uIHRva2VuIGNoZWNrJywgeyBcclxuICAgIGhhc1Rva2VuOiAhIXNlc3Npb25Ub2tlbixcclxuICAgIGNvb2tpZXNSZWNlaXZlZDogT2JqZWN0LmtleXMoY29va2llcylcclxuICB9KTtcclxuICBcclxuICAvLyBJZiBubyBzZXNzaW9uIHRva2VuLCByZXR1cm4gdW5hdXRob3JpemVkXHJcbiAgaWYgKCFzZXNzaW9uVG9rZW4pIHtcclxuICAgIGNvbnNvbGUubG9nKCdObyBzZXNzaW9uIHRva2VuIGZvdW5kLCBhdXRoZW50aWNhdGlvbiByZXF1aXJlZCcpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygnVmVyaWZ5aW5nIHNlc3Npb24gdG9rZW4nKTtcclxuICAgIFxyXG4gICAgLy8gSW1wb3J0IGF1dGggb25seSBvbiBzZXJ2ZXItc2lkZVxyXG4gICAgY29uc3QgeyBhdXRoIH0gPSByZXF1aXJlKCcuLi9saWIvYXV0aCcpO1xyXG4gICAgXHJcbiAgICAvLyBWZXJpZnkgdGhlIHNlc3Npb25cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoLnZlcmlmeVNlc3Npb24oc2Vzc2lvblRva2VuKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ1Nlc3Npb24gdmVyaWZpY2F0aW9uIHJlc3VsdCcsIHsgXHJcbiAgICAgIGhhc1VzZXI6ICEhdXNlcixcclxuICAgICAgdXNlcklkOiB1c2VyPy5pZCxcclxuICAgICAgdXNlckVtYWlsOiB1c2VyPy5lbWFpbFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIElmIHNlc3Npb24gaXMgaW52YWxpZCwgcmV0dXJuIHVuYXV0aG9yaXplZFxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdJbnZhbGlkIG9yIGV4cGlyZWQgc2Vzc2lvbicpO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgb3IgZXhwaXJlZCBzZXNzaW9uJyB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQXR0YWNoIHVzZXIgdG8gcmVxdWVzdCBvYmplY3RcclxuICAgIHJlcS51c2VyID0gdXNlcjtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ1VzZXIgYXV0aGVudGljYXRlZCBzdWNjZXNzZnVsbHknLCB7IFxyXG4gICAgICBpZDogdXNlci5pZCwgXHJcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgICBhY2NvdW50SWQ6IHVzZXIuYWNjb3VudElkLFxyXG4gICAgICBpc0FkbWluOiB1c2VyLmlzQWRtaW4gfHwgdXNlci5pc19hY2NvdW50X2FkbWluXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gQ29udGludWUgdG8gdGhlIG5leHQgbWlkZGxld2FyZSBvciBoYW5kbGVyXHJcbiAgICBpZiAobmV4dCkge1xyXG4gICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQXV0aCBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQXV0aGVudGljYXRpb24gZXJyb3InIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEZvciB1c2UgaW4gQVBJIHJvdXRlcyB0byBnZXQgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxyXG5leHBvcnQgY29uc3QgZ2V0QXV0aGVudGljYXRlZFVzZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICBjb25zdCBpc0F1dGhlbnRpY2F0ZWQgPSBhd2FpdCBhcGlBdXRoTWlkZGxld2FyZShyZXEsIHJlcyk7XHJcbiAgcmV0dXJuIGlzQXV0aGVudGljYXRlZCA9PT0gdHJ1ZSA/IHJlcS51c2VyIDogbnVsbDtcclxufTtcclxuXHJcbi8vIHdpdGhBdXRoIEhPQyBmb3IgcHJvdGVjdGluZyBBUEkgcm91dGVzIHdpdGggYXV0aGVudGljYXRpb25cclxuZXhwb3J0IGNvbnN0IHdpdGhBdXRoID0gKGhhbmRsZXIpID0+IHtcclxuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpQXV0aE1pZGRsZXdhcmUocmVxLCByZXMpO1xyXG4gICAgICBcclxuICAgICAgLy8gSWYgdGhlIG1pZGRsZXdhcmUgcmV0dXJuZWQgYSBzdGF0dXMgY29kZSwgaXQgaGFuZGxlZCB1bmF1dGhvcml6ZWRcclxuICAgICAgaWYgKHJlc3VsdCAhPT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFVzZXIgaXMgYXV0aGVudGljYXRlZCwgc28gZXhlY3V0ZSB0aGUgaGFuZGxlclxyXG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB3aXRoQXV0aCBtaWRkbGV3YXJlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3Igb2NjdXJyZWQnIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn07XHJcblxyXG4vLyB3aXRoUGVybWlzc2lvbiBIT0MgZm9yIHByb3RlY3RpbmcgQVBJIHJvdXRlcyB0aGF0IG5lZWQgc3BlY2lmaWMgcGVybWlzc2lvbnNcclxuZXhwb3J0IGNvbnN0IHdpdGhQZXJtaXNzaW9uID0gKGhhbmRsZXIsIHBlcm1pc3Npb24pID0+IHtcclxuICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgd2l0aFBlcm1pc3Npb24gbWlkZGxld2FyZSBjYWxsZWQgZm9yIHBlcm1pc3Npb246ICR7cGVybWlzc2lvbn1gKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEZpcnN0IGNoZWNrIGF1dGhlbnRpY2F0aW9uXHJcbiAgICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCBhcGlBdXRoTWlkZGxld2FyZShyZXEsIHJlcyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoYXV0aFJlc3VsdCAhPT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQgaW4gd2l0aFBlcm1pc3Npb24nLCB7IGF1dGhSZXN1bHQgfSk7XHJcbiAgICAgICAgcmV0dXJuIGF1dGhSZXN1bHQ7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIGF1dGhlbnRpY2F0ZWQgaW4gd2l0aFBlcm1pc3Npb24nLCB7IFxyXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxyXG4gICAgICAgIGVtYWlsOiByZXEudXNlcj8uZW1haWwsXHJcbiAgICAgICAgcGVybWlzc2lvbnM6IHJlcS51c2VyPy5wZXJtaXNzaW9ucyxcclxuICAgICAgICBpc0FjY291bnRBZG1pbjogcmVxLnVzZXI/LmlzX2FjY291bnRfYWRtaW5cclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBwZXJtaXNzaW9uIC0gYWxsb3cgYWNjZXNzIGlmOlxyXG4gICAgICAvLyAxLiBUaGUgdXNlciBoYXMgdGhlIHNwZWNpZmljIHBlcm1pc3Npb24sIE9SXHJcbiAgICAgIC8vIDIuIFRoZSB1c2VyIGhhcyAnYWxsJyBwZXJtaXNzaW9ucywgT1JcclxuICAgICAgLy8gMy4gVGhlIHVzZXIgaXMgYW4gYWNjb3VudCBhZG1pblxyXG4gICAgICAvLyA0LiBJZiBubyBzcGVjaWZpYyBwZXJtaXNzaW9uIGlzIHJlcXVpcmVkIChudWxsL3VuZGVmaW5lZClcclxuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xyXG4gICAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gIXBlcm1pc3Npb24gfHwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICh1c2VyLnBlcm1pc3Npb25zICYmIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAodXNlci5wZXJtaXNzaW9uc1twZXJtaXNzaW9uXSA9PT0gdHJ1ZSB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIucGVybWlzc2lvbnMuYWxsID09PSB0cnVlIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlci5pc19hY2NvdW50X2FkbWluID09PSB0cnVlKSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWhhc1Blcm1pc3Npb24pIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnUGVybWlzc2lvbiBkZW5pZWQgaW4gd2l0aFBlcm1pc3Npb24nLCB7IFxyXG4gICAgICAgICAgcmVxdWlyZWRQZXJtaXNzaW9uOiBwZXJtaXNzaW9uLFxyXG4gICAgICAgICAgdXNlclBlcm1pc3Npb25zOiB1c2VyLnBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgaXNBZG1pbjogdXNlci5pc19hY2NvdW50X2FkbWluXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBhY2Nlc3MgdGhpcyByZXNvdXJjZScgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdQZXJtaXNzaW9uIGdyYW50ZWQgaW4gd2l0aFBlcm1pc3Npb24nLCB7IHBlcm1pc3Npb24gfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVc2VyIGlzIGF1dGhlbnRpY2F0ZWQgYW5kIGhhcyBwZXJtaXNzaW9uLCBzbyBleGVjdXRlIHRoZSBoYW5kbGVyXHJcbiAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVyKHJlcSwgcmVzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHdpdGhQZXJtaXNzaW9uIG1pZGRsZXdhcmU6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0FuIGludGVybmFsIHNlcnZlciBlcnJvciBvY2N1cnJlZCcgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufTtcclxuXHJcbi8vIHdpdGhBdXRoUmVkaXJlY3QgSE9DIGZvciBjbGllbnQtc2lkZSBhdXRoIGNoZWNraW5nIHdpdGggcmVkaXJlY3RcclxuZXhwb3J0IGNvbnN0IHdpdGhBdXRoUmVkaXJlY3QgPSAoQ29tcG9uZW50LCBvcHRpb25zID0geyBhZG1pbk9ubHk6IGZhbHNlIH0pID0+IHtcclxuICAvLyBUaGlzIGlzIGp1c3QgYSB3cmFwcGVyIGFyb3VuZCB3aXRoQXV0aFByb3RlY3Rpb24gZm9yIGNvbnNpc3RlbmN5XHJcbiAgcmV0dXJuIENvbXBvbmVudDtcclxufTsiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiYXV0aE1pZGRsZXdhcmUiLCJyZXEiLCJwYXRobmFtZSIsIm5leHRVcmwiLCJwdWJsaWNQYXRocyIsImlzUHVibGljUGF0aCIsInNvbWUiLCJwYXRoIiwic3RhcnRzV2l0aCIsIm5leHQiLCJzZXNzaW9uVG9rZW4iLCJjb29raWVzIiwiZ2V0IiwidmFsdWUiLCJ1cmwiLCJVUkwiLCJzZWFyY2hQYXJhbXMiLCJzZXQiLCJyZWRpcmVjdCIsImlzQXV0aGVudGljYXRlZCIsImRvY3VtZW50IiwiY29va2llIiwic3BsaXQiLCJyZWR1Y2UiLCJhY2MiLCJrZXkiLCJ0cmltIiwic2Vzc2lvbl90b2tlbiIsImFwaUF1dGhNaWRkbGV3YXJlIiwicmVzIiwiY29uc29sZSIsImxvZyIsIm1ldGhvZCIsInF1ZXJ5IiwiZXJyb3IiLCJFcnJvciIsImhhc1Rva2VuIiwiY29va2llc1JlY2VpdmVkIiwiT2JqZWN0Iiwia2V5cyIsInN0YXR1cyIsImpzb24iLCJhdXRoIiwicmVxdWlyZSIsInVzZXIiLCJ2ZXJpZnlTZXNzaW9uIiwiaGFzVXNlciIsInVzZXJJZCIsImlkIiwidXNlckVtYWlsIiwiZW1haWwiLCJhY2NvdW50SWQiLCJpc0FkbWluIiwiaXNfYWNjb3VudF9hZG1pbiIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwid2l0aEF1dGgiLCJoYW5kbGVyIiwicmVzdWx0Iiwid2l0aFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwiYXV0aFJlc3VsdCIsInBlcm1pc3Npb25zIiwiaXNBY2NvdW50QWRtaW4iLCJoYXNQZXJtaXNzaW9uIiwiYWxsIiwicmVxdWlyZWRQZXJtaXNzaW9uIiwidXNlclBlcm1pc3Npb25zIiwid2l0aEF1dGhSZWRpcmVjdCIsIkNvbXBvbmVudCIsIm9wdGlvbnMiLCJhZG1pbk9ubHkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./middleware/auth.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdeals%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdeals%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\deals\\[id].js */ \"(api-node)/./pages/api/deals/[id].js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/deals/[id]\",\n        pathname: \"/api/deals/[id]\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_deals_id_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGZGVhbHMlMkYlNUJpZCU1RCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDZGVhbHMlNUMlNUJpZCU1RC5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDRTtBQUMxRDtBQUN5RDtBQUN6RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsbURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG1EQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLHlHQUFtQjtBQUNsRDtBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGRlYWxzXFxcXFtpZF0uanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2RlYWxzL1tpZF1cIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kZWFscy9baWRdXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdeals%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/deals/[id].js":
/*!*********************************!*\
  !*** ./pages/api/deals/[id].js ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/db */ \"(api-node)/./lib/db.js\");\n/* harmony import */ var _utils_activityLogger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/activityLogger */ \"(api-node)/./utils/activityLogger.js\");\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../middleware/auth */ \"(api-node)/./middleware/auth.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_utils_activityLogger__WEBPACK_IMPORTED_MODULE_1__]);\n_utils_activityLogger__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/deals/[id].js\n\n\n\nasync function handler(req, res) {\n    const { id } = req.query;\n    if (req.method === 'GET') {\n        try {\n            // First, check which tables and columns exist in the database\n            const tablesQuery = `\n        SELECT table_name \n        FROM information_schema.tables \n        WHERE table_schema = 'public'\n      `;\n            const tablesResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(tablesQuery);\n            const existingTables = tablesResult.rows.map((row)=>row.table_name);\n            console.log('Existing tables:', existingTables);\n            // Build query dynamically based on existing tables\n            let dealQuery = 'SELECT d.*';\n            let fromClause = ' FROM deals d';\n            let whereClause = ' WHERE d.deal_id = $1 OR d.deal_id = $1';\n            // Check if dim_property exists and add the join\n            if (existingTables.includes('dim_property')) {\n                // Get columns from dim_property\n                const propertyColumnsQuery = `\n          SELECT column_name \n          FROM information_schema.columns \n          WHERE table_schema = 'public' AND table_name = 'dim_property'\n        `;\n                const propertyColumns = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(propertyColumnsQuery);\n                const propertyColumnNames = propertyColumns.rows.map((row)=>row.column_name);\n                // Find property id column\n                const propertyIdColumn = propertyColumnNames.includes('property_key') ? 'property_key' : propertyColumnNames.includes('id') ? 'id' : 'property_id';\n                // Find deal's property reference column\n                const dealColumnsQuery = `\n          SELECT column_name \n          FROM information_schema.columns \n          WHERE table_schema = 'public' AND table_name = 'deals'\n        `;\n                const dealColumns = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(dealColumnsQuery);\n                const dealColumnNames = dealColumns.rows.map((row)=>row.column_name);\n                // Find property reference in deals table\n                const dealPropertyColumn = dealColumnNames.includes('property_id') ? 'property_id' : dealColumnNames.includes('property_key') ? 'property_key' : null;\n                if (dealPropertyColumn) {\n                    dealQuery += ', p.demo_name';\n                    if (propertyColumnNames.includes('address')) {\n                        dealQuery += ', p.address as property_address';\n                    }\n                    fromClause += ` LEFT JOIN dim_property p ON d.${dealPropertyColumn} = p.${propertyIdColumn}`;\n                    // Add additional joins based on existing tables\n                    if (existingTables.includes('dim_city') && propertyColumnNames.includes('city_key')) {\n                        dealQuery += ', c.city_name';\n                        fromClause += ' LEFT JOIN dim_city c ON p.city_key = c.city_key';\n                        if (existingTables.includes('dim_state')) {\n                            dealQuery += ', s.state_name';\n                            fromClause += ' LEFT JOIN dim_state s ON c.state_key = s.state_key';\n                        }\n                    }\n                    if (existingTables.includes('dim_brand') && propertyColumnNames.includes('brand_key')) {\n                        dealQuery += ', b.brand_name';\n                        fromClause += ' LEFT JOIN dim_brand b ON p.brand_key = b.brand_key';\n                    }\n                    if (existingTables.includes('dim_hotel_type') && propertyColumnNames.includes('hotel_type_key')) {\n                        dealQuery += ', ht.hotel_type_name';\n                        fromClause += ' LEFT JOIN dim_hotel_type ht ON p.hotel_type_key = ht.hotel_type_key';\n                    }\n                    if (existingTables.includes('dim_market') && propertyColumnNames.includes('market_key')) {\n                        dealQuery += ', m.market_name';\n                        fromClause += ' LEFT JOIN dim_market m ON p.market_key = m.market_key';\n                        if (existingTables.includes('dim_region')) {\n                            dealQuery += ', r.region_name';\n                            fromClause += ' LEFT JOIN dim_region r ON m.region_key = r.region_key';\n                        }\n                    }\n                    if (existingTables.includes('dim_chain_scale') && propertyColumnNames.includes('chain_scale_key')) {\n                        dealQuery += ', cs.chain_scale_name';\n                        fromClause += ' LEFT JOIN dim_chain_scale cs ON p.chain_scale_key = cs.chain_scale_key';\n                    }\n                }\n            }\n            const finalQuery = dealQuery + fromClause + whereClause;\n            console.log('Deal query:', finalQuery);\n            const dealResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(finalQuery, [\n                id\n            ]);\n            if (dealResult.rows.length === 0) {\n                return res.status(404).json({\n                    error: 'Deal not found'\n                });\n            }\n            const deal = dealResult.rows[0];\n            console.log('Deal data:', deal);\n            // Initialize market data\n            let marketTrends = [];\n            let marketComparison = [];\n            let performanceMetrics = {\n                revpar: 125.75,\n                adr: 160.80,\n                occupancy: 0.782,\n                cap_rate: 0.068\n            };\n            // Try to fetch market trends data if available\n            if (existingTables.includes('fact_market_data') && deal.market_key) {\n                try {\n                    const trendsQuery = `\n            SELECT year, month, revpar, adr, occupancy\n            FROM fact_market_data\n            WHERE market_key = $1\n            ORDER BY year, month\n          `;\n                    const trendsResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(trendsQuery, [\n                        deal.market_key\n                    ]);\n                    marketTrends = trendsResult.rows;\n                } catch (error) {\n                    console.error('Error fetching market trends:', error);\n                    // Use generated data if there's an error\n                    marketTrends = generateMockMarketTrends();\n                }\n            } else {\n                // Generate mock market trends data\n                marketTrends = generateMockMarketTrends();\n            }\n            // Try to fetch market comparison data if available\n            if (existingTables.includes('fact_market_data') && existingTables.includes('dim_market') && deal.region_key) {\n                try {\n                    const comparisonQuery = `\n            SELECT \n              m.market_name,\n              AVG(fmd.revpar) as avg_revpar,\n              AVG(fmd.adr) as avg_adr,\n              AVG(fmd.occupancy) as avg_occupancy\n            FROM dim_market m\n            JOIN fact_market_data fmd ON m.market_key = fmd.market_key\n            WHERE m.region_key = $1 AND m.market_key != $2\n            GROUP BY m.market_name\n            LIMIT 3\n          `;\n                    const comparisonResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(comparisonQuery, [\n                        deal.region_key,\n                        deal.market_key || 0\n                    ]);\n                    marketComparison = comparisonResult.rows;\n                } catch (error) {\n                    console.error('Error fetching market comparison:', error);\n                    // Use generated data if there's an error\n                    marketComparison = generateMockMarketComparison();\n                }\n            } else {\n                // Generate mock market comparison data\n                marketComparison = generateMockMarketComparison();\n            }\n            // Try to fetch performance metrics if available\n            if (existingTables.includes('fact_market_data') && deal.market_key) {\n                try {\n                    const performanceQuery = `\n            SELECT \n              AVG(revpar) as revpar,\n              AVG(adr) as adr,\n              AVG(occupancy) as occupancy,\n              AVG(revpar_growth) as revpar_growth\n            FROM fact_market_data\n            WHERE market_key = $1 AND year = 2023\n          `;\n                    const performanceResult = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(performanceQuery, [\n                        deal.market_key\n                    ]);\n                    if (performanceResult.rows.length > 0) {\n                        performanceMetrics = {\n                            ...performanceMetrics,\n                            ...performanceResult.rows[0]\n                        };\n                    }\n                } catch (error) {\n                    console.error('Error fetching performance metrics:', error);\n                // Keep default performance metrics if there's an error\n                }\n            }\n            // Combine all data and add fallbacks\n            const dealDetails = addFallbackData({\n                ...deal,\n                market_trends: marketTrends,\n                market_comparison: marketComparison,\n                performance_metrics: performanceMetrics\n            });\n            res.status(200).json(dealDetails);\n        } catch (error) {\n            console.error('Error fetching deal details:', error);\n            res.status(500).json({\n                error: 'Failed to fetch deal details',\n                details: error.message\n            });\n        }\n    } else if (req.method === 'PUT') {\n        try {\n            const { deal_name, property_name, property_address, city, state, number_of_rooms, property_type, status } = req.body;\n            // Validate required fields\n            if (!deal_name) {\n                return res.status(400).json({\n                    error: 'Deal name is required'\n                });\n            }\n            // Get the current column names for the deals table\n            const dealColumnsQuery = `\n        SELECT column_name \n        FROM information_schema.columns \n        WHERE table_schema = 'public' AND table_name = 'deals'\n      `;\n            const dealColumns = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(dealColumnsQuery);\n            const dealColumnNames = dealColumns.rows.map((row)=>row.column_name);\n            // Build the update query dynamically based on available columns\n            const updateFields = [];\n            const queryParams = [\n                id\n            ]; // First param is the deal ID\n            let paramIndex = 2; // Starts at 2 since $1 is used for deal_id\n            if (dealColumnNames.includes('deal_name')) {\n                updateFields.push(`deal_name = $${paramIndex++}`);\n                queryParams.push(deal_name);\n            }\n            if (dealColumnNames.includes('property_name')) {\n                updateFields.push(`property_name = $${paramIndex++}`);\n                queryParams.push(property_name);\n            }\n            if (dealColumnNames.includes('property_address')) {\n                updateFields.push(`property_address = $${paramIndex++}`);\n                queryParams.push(property_address);\n            }\n            if (dealColumnNames.includes('city')) {\n                updateFields.push(`city = $${paramIndex++}`);\n                queryParams.push(city);\n            }\n            if (dealColumnNames.includes('state')) {\n                updateFields.push(`state = $${paramIndex++}`);\n                queryParams.push(state);\n            }\n            if (dealColumnNames.includes('number_of_rooms')) {\n                updateFields.push(`number_of_rooms = $${paramIndex++}`);\n                queryParams.push(number_of_rooms ? parseInt(number_of_rooms) : null);\n            }\n            if (dealColumnNames.includes('property_type')) {\n                updateFields.push(`property_type = $${paramIndex++}`);\n                queryParams.push(property_type);\n            }\n            if (dealColumnNames.includes('status')) {\n                updateFields.push(`status = $${paramIndex++}`);\n                queryParams.push(status);\n            }\n            if (dealColumnNames.includes('updated_at')) {\n                updateFields.push(`updated_at = CURRENT_TIMESTAMP`);\n            }\n            if (updateFields.length === 0) {\n                return res.status(400).json({\n                    error: 'No valid fields to update'\n                });\n            }\n            const updateQuery = `\n        UPDATE deals \n        SET ${updateFields.join(', ')} \n        WHERE deal_id = $1 \n        RETURNING *`;\n            console.log('Update query:', updateQuery);\n            console.log('Query params:', queryParams);\n            const result = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.query)(updateQuery, queryParams);\n            if (result.rows.length === 0) {\n                return res.status(404).json({\n                    error: 'Deal not found or could not be updated'\n                });\n            }\n            // Log the activity\n            try {\n                await (0,_utils_activityLogger__WEBPACK_IMPORTED_MODULE_1__.saveActivityLog)({\n                    user_id: req.user?.id || req.user?.user_id || 'system',\n                    action: 'UPDATE_DEAL',\n                    entity_type: 'DEAL',\n                    entity_id: id,\n                    details: `Updated deal ${deal_name}`\n                });\n            } catch (logError) {\n                console.error('Error logging deal update activity:', logError);\n            // Continue even if logging fails\n            }\n            res.status(200).json(result.rows[0]);\n        } catch (error) {\n            console.error('Error updating deal:', error);\n            res.status(500).json({\n                error: 'Failed to update deal',\n                details: error.message\n            });\n        }\n    } else {\n        res.setHeader('Allow', [\n            'GET',\n            'PUT'\n        ]);\n        res.status(405).end(`Method ${req.method} Not Allowed`);\n    }\n}\n// Add fallback data for missing fields\nconst addFallbackData = (deal)=>{\n    // Basic deal info fallbacks\n    deal.deal_name = deal.deal_name || `${deal.property_name || 'Hotel'} Investment`;\n    deal.investment_amount = deal.investment_amount || 1000000;\n    deal.expected_return = deal.expected_return || 8.5;\n    deal.status = deal.status || 'Draft';\n    // Property info fallbacks\n    deal.property_name = deal.property_name || 'Hotel Property';\n    deal.property_address = deal.property_address || '123 Main Street';\n    deal.city_name = deal.city_name || 'New York';\n    deal.state_name = deal.state_name || 'NY';\n    deal.hotel_type_name = deal.hotel_type_name || 'Luxury';\n    // Market data fallbacks\n    deal.market_name = deal.market_name || 'New York';\n    deal.region_name = deal.region_name || 'Northeast';\n    deal.brand_name = deal.brand_name || 'Independent';\n    deal.chain_scale_name = deal.chain_scale_name || 'Upscale';\n    // If market trends data is missing or empty, create placeholder data\n    if (!deal.market_trends || deal.market_trends.length === 0) {\n        deal.market_trends = generateMockMarketTrends();\n    }\n    // If market comparison data is missing or empty, create placeholder data\n    if (!deal.market_comparison || deal.market_comparison.length === 0) {\n        deal.market_comparison = generateMockMarketComparison();\n    }\n    return deal;\n};\n// Generate mock market trends data\nconst generateMockMarketTrends = ()=>{\n    const trends = [];\n    const currentYear = new Date().getFullYear();\n    for(let year = currentYear - 4; year <= currentYear; year++){\n        for(let month = 1; month <= 12; month++){\n            // Skip future months in current year\n            if (year === currentYear && month > new Date().getMonth() + 1) continue;\n            // Calculate some realistic values with seasonal variations\n            const seasonalFactor = 1 + Math.sin((month - 1) * Math.PI / 6) * 0.15; // Seasonal variation\n            const yearGrowth = 1 + (year - (currentYear - 4)) * 0.05; // Year-over-year growth\n            trends.push({\n                year,\n                month,\n                revpar: Math.round(100 * seasonalFactor * yearGrowth),\n                adr: Math.round(150 * seasonalFactor * yearGrowth),\n                occupancy: Math.min(0.95, Math.max(0.6, 0.75 * seasonalFactor * yearGrowth))\n            });\n        }\n    }\n    return trends;\n};\n// Generate mock market comparison data\nconst generateMockMarketComparison = ()=>{\n    return [\n        {\n            market_name: 'New York',\n            avg_revpar: 210.50,\n            avg_adr: 275.30,\n            avg_occupancy: 0.76\n        },\n        {\n            market_name: 'Boston',\n            avg_revpar: 185.25,\n            avg_adr: 245.80,\n            avg_occupancy: 0.75\n        },\n        {\n            market_name: 'Philadelphia',\n            avg_revpar: 145.80,\n            avg_adr: 195.40,\n            avg_occupancy: 0.74\n        }\n    ];\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_2__.withAuth)(handler));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBQVFDLGVBQWU7UUFBSztLQUN6RjtBQUNIO0FBRUEsaUVBQWU3RywwREFBUUEsQ0FBQ0MsUUFBUUEsRUFBQyIsInNvdXJjZXMiOlsiQzpcXHZpbm9kXFxwcm9qZWN0c1xcaW5udmVzdFxcUE9DXFxpbm52ZXN0YWlcXHBhZ2VzXFxhcGlcXGRlYWxzXFxbaWRdLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9kZWFscy9baWRdLmpzXHJcbmltcG9ydCB7IHF1ZXJ5IH0gZnJvbSAnLi4vLi4vLi4vbGliL2RiJztcclxuaW1wb3J0IHsgc2F2ZUFjdGl2aXR5TG9nIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvYWN0aXZpdHlMb2dnZXInO1xyXG5pbXBvcnQgeyB3aXRoQXV0aCB9IGZyb20gJy4uLy4uLy4uL21pZGRsZXdhcmUvYXV0aCc7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnF1ZXJ5O1xyXG4gIFxyXG4gIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gRmlyc3QsIGNoZWNrIHdoaWNoIHRhYmxlcyBhbmQgY29sdW1ucyBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgY29uc3QgdGFibGVzUXVlcnkgPSBgXHJcbiAgICAgICAgU0VMRUNUIHRhYmxlX25hbWUgXHJcbiAgICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIFxyXG4gICAgICAgIFdIRVJFIHRhYmxlX3NjaGVtYSA9ICdwdWJsaWMnXHJcbiAgICAgIGA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB0YWJsZXNSZXN1bHQgPSBhd2FpdCBxdWVyeSh0YWJsZXNRdWVyeSk7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nVGFibGVzID0gdGFibGVzUmVzdWx0LnJvd3MubWFwKHJvdyA9PiByb3cudGFibGVfbmFtZSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdFeGlzdGluZyB0YWJsZXM6JywgZXhpc3RpbmdUYWJsZXMpO1xyXG4gICAgICBcclxuICAgICAgLy8gQnVpbGQgcXVlcnkgZHluYW1pY2FsbHkgYmFzZWQgb24gZXhpc3RpbmcgdGFibGVzXHJcbiAgICAgIGxldCBkZWFsUXVlcnkgPSAnU0VMRUNUIGQuKic7XHJcbiAgICAgIGxldCBmcm9tQ2xhdXNlID0gJyBGUk9NIGRlYWxzIGQnO1xyXG4gICAgICBsZXQgd2hlcmVDbGF1c2UgPSAnIFdIRVJFIGQuZGVhbF9pZCA9ICQxIE9SIGQuZGVhbF9pZCA9ICQxJztcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIGRpbV9wcm9wZXJ0eSBleGlzdHMgYW5kIGFkZCB0aGUgam9pblxyXG4gICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9wcm9wZXJ0eScpKSB7XHJcbiAgICAgICAgLy8gR2V0IGNvbHVtbnMgZnJvbSBkaW1fcHJvcGVydHlcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUNvbHVtbnNRdWVyeSA9IGBcclxuICAgICAgICAgIFNFTEVDVCBjb2x1bW5fbmFtZSBcclxuICAgICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgXHJcbiAgICAgICAgICBXSEVSRSB0YWJsZV9zY2hlbWEgPSAncHVibGljJyBBTkQgdGFibGVfbmFtZSA9ICdkaW1fcHJvcGVydHknXHJcbiAgICAgICAgYDtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUNvbHVtbnMgPSBhd2FpdCBxdWVyeShwcm9wZXJ0eUNvbHVtbnNRdWVyeSk7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlDb2x1bW5OYW1lcyA9IHByb3BlcnR5Q29sdW1ucy5yb3dzLm1hcChyb3cgPT4gcm93LmNvbHVtbl9uYW1lKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBGaW5kIHByb3BlcnR5IGlkIGNvbHVtblxyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5SWRDb2x1bW4gPSBwcm9wZXJ0eUNvbHVtbk5hbWVzLmluY2x1ZGVzKCdwcm9wZXJ0eV9rZXknKSA/ICdwcm9wZXJ0eV9rZXknIDogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlDb2x1bW5OYW1lcy5pbmNsdWRlcygnaWQnKSA/ICdpZCcgOiAncHJvcGVydHlfaWQnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEZpbmQgZGVhbCdzIHByb3BlcnR5IHJlZmVyZW5jZSBjb2x1bW5cclxuICAgICAgICBjb25zdCBkZWFsQ29sdW1uc1F1ZXJ5ID0gYFxyXG4gICAgICAgICAgU0VMRUNUIGNvbHVtbl9uYW1lIFxyXG4gICAgICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1ucyBcclxuICAgICAgICAgIFdIRVJFIHRhYmxlX3NjaGVtYSA9ICdwdWJsaWMnIEFORCB0YWJsZV9uYW1lID0gJ2RlYWxzJ1xyXG4gICAgICAgIGA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZGVhbENvbHVtbnMgPSBhd2FpdCBxdWVyeShkZWFsQ29sdW1uc1F1ZXJ5KTtcclxuICAgICAgICBjb25zdCBkZWFsQ29sdW1uTmFtZXMgPSBkZWFsQ29sdW1ucy5yb3dzLm1hcChyb3cgPT4gcm93LmNvbHVtbl9uYW1lKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBGaW5kIHByb3BlcnR5IHJlZmVyZW5jZSBpbiBkZWFscyB0YWJsZVxyXG4gICAgICAgIGNvbnN0IGRlYWxQcm9wZXJ0eUNvbHVtbiA9IGRlYWxDb2x1bW5OYW1lcy5pbmNsdWRlcygncHJvcGVydHlfaWQnKSA/ICdwcm9wZXJ0eV9pZCcgOiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdwcm9wZXJ0eV9rZXknKSA/ICdwcm9wZXJ0eV9rZXknIDogbnVsbDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZGVhbFByb3BlcnR5Q29sdW1uKSB7XHJcbiAgICAgICAgICBkZWFsUXVlcnkgKz0gJywgcC5kZW1vX25hbWUnO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAocHJvcGVydHlDb2x1bW5OYW1lcy5pbmNsdWRlcygnYWRkcmVzcycpKSB7XHJcbiAgICAgICAgICAgIGRlYWxRdWVyeSArPSAnLCBwLmFkZHJlc3MgYXMgcHJvcGVydHlfYWRkcmVzcyc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGZyb21DbGF1c2UgKz0gYCBMRUZUIEpPSU4gZGltX3Byb3BlcnR5IHAgT04gZC4ke2RlYWxQcm9wZXJ0eUNvbHVtbn0gPSBwLiR7cHJvcGVydHlJZENvbHVtbn1gO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBBZGQgYWRkaXRpb25hbCBqb2lucyBiYXNlZCBvbiBleGlzdGluZyB0YWJsZXNcclxuICAgICAgICAgIGlmIChleGlzdGluZ1RhYmxlcy5pbmNsdWRlcygnZGltX2NpdHknKSAmJiBwcm9wZXJ0eUNvbHVtbk5hbWVzLmluY2x1ZGVzKCdjaXR5X2tleScpKSB7XHJcbiAgICAgICAgICAgIGRlYWxRdWVyeSArPSAnLCBjLmNpdHlfbmFtZSc7XHJcbiAgICAgICAgICAgIGZyb21DbGF1c2UgKz0gJyBMRUZUIEpPSU4gZGltX2NpdHkgYyBPTiBwLmNpdHlfa2V5ID0gYy5jaXR5X2tleSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9zdGF0ZScpKSB7XHJcbiAgICAgICAgICAgICAgZGVhbFF1ZXJ5ICs9ICcsIHMuc3RhdGVfbmFtZSc7XHJcbiAgICAgICAgICAgICAgZnJvbUNsYXVzZSArPSAnIExFRlQgSk9JTiBkaW1fc3RhdGUgcyBPTiBjLnN0YXRlX2tleSA9IHMuc3RhdGVfa2V5JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9icmFuZCcpICYmIHByb3BlcnR5Q29sdW1uTmFtZXMuaW5jbHVkZXMoJ2JyYW5kX2tleScpKSB7XHJcbiAgICAgICAgICAgIGRlYWxRdWVyeSArPSAnLCBiLmJyYW5kX25hbWUnO1xyXG4gICAgICAgICAgICBmcm9tQ2xhdXNlICs9ICcgTEVGVCBKT0lOIGRpbV9icmFuZCBiIE9OIHAuYnJhbmRfa2V5ID0gYi5icmFuZF9rZXknO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9ob3RlbF90eXBlJykgJiYgcHJvcGVydHlDb2x1bW5OYW1lcy5pbmNsdWRlcygnaG90ZWxfdHlwZV9rZXknKSkge1xyXG4gICAgICAgICAgICBkZWFsUXVlcnkgKz0gJywgaHQuaG90ZWxfdHlwZV9uYW1lJztcclxuICAgICAgICAgICAgZnJvbUNsYXVzZSArPSAnIExFRlQgSk9JTiBkaW1faG90ZWxfdHlwZSBodCBPTiBwLmhvdGVsX3R5cGVfa2V5ID0gaHQuaG90ZWxfdHlwZV9rZXknO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9tYXJrZXQnKSAmJiBwcm9wZXJ0eUNvbHVtbk5hbWVzLmluY2x1ZGVzKCdtYXJrZXRfa2V5JykpIHtcclxuICAgICAgICAgICAgZGVhbFF1ZXJ5ICs9ICcsIG0ubWFya2V0X25hbWUnO1xyXG4gICAgICAgICAgICBmcm9tQ2xhdXNlICs9ICcgTEVGVCBKT0lOIGRpbV9tYXJrZXQgbSBPTiBwLm1hcmtldF9rZXkgPSBtLm1hcmtldF9rZXknO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGFibGVzLmluY2x1ZGVzKCdkaW1fcmVnaW9uJykpIHtcclxuICAgICAgICAgICAgICBkZWFsUXVlcnkgKz0gJywgci5yZWdpb25fbmFtZSc7XHJcbiAgICAgICAgICAgICAgZnJvbUNsYXVzZSArPSAnIExFRlQgSk9JTiBkaW1fcmVnaW9uIHIgT04gbS5yZWdpb25fa2V5ID0gci5yZWdpb25fa2V5JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2RpbV9jaGFpbl9zY2FsZScpICYmIHByb3BlcnR5Q29sdW1uTmFtZXMuaW5jbHVkZXMoJ2NoYWluX3NjYWxlX2tleScpKSB7XHJcbiAgICAgICAgICAgIGRlYWxRdWVyeSArPSAnLCBjcy5jaGFpbl9zY2FsZV9uYW1lJztcclxuICAgICAgICAgICAgZnJvbUNsYXVzZSArPSAnIExFRlQgSk9JTiBkaW1fY2hhaW5fc2NhbGUgY3MgT04gcC5jaGFpbl9zY2FsZV9rZXkgPSBjcy5jaGFpbl9zY2FsZV9rZXknO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc3QgZmluYWxRdWVyeSA9IGRlYWxRdWVyeSArIGZyb21DbGF1c2UgKyB3aGVyZUNsYXVzZTtcclxuICAgICAgY29uc29sZS5sb2coJ0RlYWwgcXVlcnk6JywgZmluYWxRdWVyeSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBkZWFsUmVzdWx0ID0gYXdhaXQgcXVlcnkoZmluYWxRdWVyeSwgW2lkXSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbFJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnRGVhbCBub3QgZm91bmQnIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBkZWFsID0gZGVhbFJlc3VsdC5yb3dzWzBdO1xyXG4gICAgICBjb25zb2xlLmxvZygnRGVhbCBkYXRhOicsIGRlYWwpO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBtYXJrZXQgZGF0YVxyXG4gICAgICBsZXQgbWFya2V0VHJlbmRzID0gW107XHJcbiAgICAgIGxldCBtYXJrZXRDb21wYXJpc29uID0gW107XHJcbiAgICAgIGxldCBwZXJmb3JtYW5jZU1ldHJpY3MgPSB7XHJcbiAgICAgICAgcmV2cGFyOiAxMjUuNzUsXHJcbiAgICAgICAgYWRyOiAxNjAuODAsXHJcbiAgICAgICAgb2NjdXBhbmN5OiAwLjc4MixcclxuICAgICAgICBjYXBfcmF0ZTogMC4wNjhcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFRyeSB0byBmZXRjaCBtYXJrZXQgdHJlbmRzIGRhdGEgaWYgYXZhaWxhYmxlXHJcbiAgICAgIGlmIChleGlzdGluZ1RhYmxlcy5pbmNsdWRlcygnZmFjdF9tYXJrZXRfZGF0YScpICYmIGRlYWwubWFya2V0X2tleSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCB0cmVuZHNRdWVyeSA9IGBcclxuICAgICAgICAgICAgU0VMRUNUIHllYXIsIG1vbnRoLCByZXZwYXIsIGFkciwgb2NjdXBhbmN5XHJcbiAgICAgICAgICAgIEZST00gZmFjdF9tYXJrZXRfZGF0YVxyXG4gICAgICAgICAgICBXSEVSRSBtYXJrZXRfa2V5ID0gJDFcclxuICAgICAgICAgICAgT1JERVIgQlkgeWVhciwgbW9udGhcclxuICAgICAgICAgIGA7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnN0IHRyZW5kc1Jlc3VsdCA9IGF3YWl0IHF1ZXJ5KHRyZW5kc1F1ZXJ5LCBbZGVhbC5tYXJrZXRfa2V5XSk7XHJcbiAgICAgICAgICBtYXJrZXRUcmVuZHMgPSB0cmVuZHNSZXN1bHQucm93cztcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgbWFya2V0IHRyZW5kczonLCBlcnJvcik7XHJcbiAgICAgICAgICAvLyBVc2UgZ2VuZXJhdGVkIGRhdGEgaWYgdGhlcmUncyBhbiBlcnJvclxyXG4gICAgICAgICAgbWFya2V0VHJlbmRzID0gZ2VuZXJhdGVNb2NrTWFya2V0VHJlbmRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdlbmVyYXRlIG1vY2sgbWFya2V0IHRyZW5kcyBkYXRhXHJcbiAgICAgICAgbWFya2V0VHJlbmRzID0gZ2VuZXJhdGVNb2NrTWFya2V0VHJlbmRzKCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFRyeSB0byBmZXRjaCBtYXJrZXQgY29tcGFyaXNvbiBkYXRhIGlmIGF2YWlsYWJsZVxyXG4gICAgICBpZiAoZXhpc3RpbmdUYWJsZXMuaW5jbHVkZXMoJ2ZhY3RfbWFya2V0X2RhdGEnKSAmJiBleGlzdGluZ1RhYmxlcy5pbmNsdWRlcygnZGltX21hcmtldCcpICYmIGRlYWwucmVnaW9uX2tleSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBjb21wYXJpc29uUXVlcnkgPSBgXHJcbiAgICAgICAgICAgIFNFTEVDVCBcclxuICAgICAgICAgICAgICBtLm1hcmtldF9uYW1lLFxyXG4gICAgICAgICAgICAgIEFWRyhmbWQucmV2cGFyKSBhcyBhdmdfcmV2cGFyLFxyXG4gICAgICAgICAgICAgIEFWRyhmbWQuYWRyKSBhcyBhdmdfYWRyLFxyXG4gICAgICAgICAgICAgIEFWRyhmbWQub2NjdXBhbmN5KSBhcyBhdmdfb2NjdXBhbmN5XHJcbiAgICAgICAgICAgIEZST00gZGltX21hcmtldCBtXHJcbiAgICAgICAgICAgIEpPSU4gZmFjdF9tYXJrZXRfZGF0YSBmbWQgT04gbS5tYXJrZXRfa2V5ID0gZm1kLm1hcmtldF9rZXlcclxuICAgICAgICAgICAgV0hFUkUgbS5yZWdpb25fa2V5ID0gJDEgQU5EIG0ubWFya2V0X2tleSAhPSAkMlxyXG4gICAgICAgICAgICBHUk9VUCBCWSBtLm1hcmtldF9uYW1lXHJcbiAgICAgICAgICAgIExJTUlUIDNcclxuICAgICAgICAgIGA7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnN0IGNvbXBhcmlzb25SZXN1bHQgPSBhd2FpdCBxdWVyeShjb21wYXJpc29uUXVlcnksIFtkZWFsLnJlZ2lvbl9rZXksIGRlYWwubWFya2V0X2tleSB8fCAwXSk7XHJcbiAgICAgICAgICBtYXJrZXRDb21wYXJpc29uID0gY29tcGFyaXNvblJlc3VsdC5yb3dzO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBtYXJrZXQgY29tcGFyaXNvbjonLCBlcnJvcik7XHJcbiAgICAgICAgICAvLyBVc2UgZ2VuZXJhdGVkIGRhdGEgaWYgdGhlcmUncyBhbiBlcnJvclxyXG4gICAgICAgICAgbWFya2V0Q29tcGFyaXNvbiA9IGdlbmVyYXRlTW9ja01hcmtldENvbXBhcmlzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgbW9jayBtYXJrZXQgY29tcGFyaXNvbiBkYXRhXHJcbiAgICAgICAgbWFya2V0Q29tcGFyaXNvbiA9IGdlbmVyYXRlTW9ja01hcmtldENvbXBhcmlzb24oKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVHJ5IHRvIGZldGNoIHBlcmZvcm1hbmNlIG1ldHJpY3MgaWYgYXZhaWxhYmxlXHJcbiAgICAgIGlmIChleGlzdGluZ1RhYmxlcy5pbmNsdWRlcygnZmFjdF9tYXJrZXRfZGF0YScpICYmIGRlYWwubWFya2V0X2tleSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBwZXJmb3JtYW5jZVF1ZXJ5ID0gYFxyXG4gICAgICAgICAgICBTRUxFQ1QgXHJcbiAgICAgICAgICAgICAgQVZHKHJldnBhcikgYXMgcmV2cGFyLFxyXG4gICAgICAgICAgICAgIEFWRyhhZHIpIGFzIGFkcixcclxuICAgICAgICAgICAgICBBVkcob2NjdXBhbmN5KSBhcyBvY2N1cGFuY3ksXHJcbiAgICAgICAgICAgICAgQVZHKHJldnBhcl9ncm93dGgpIGFzIHJldnBhcl9ncm93dGhcclxuICAgICAgICAgICAgRlJPTSBmYWN0X21hcmtldF9kYXRhXHJcbiAgICAgICAgICAgIFdIRVJFIG1hcmtldF9rZXkgPSAkMSBBTkQgeWVhciA9IDIwMjNcclxuICAgICAgICAgIGA7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnN0IHBlcmZvcm1hbmNlUmVzdWx0ID0gYXdhaXQgcXVlcnkocGVyZm9ybWFuY2VRdWVyeSwgW2RlYWwubWFya2V0X2tleV0pO1xyXG4gICAgICAgICAgaWYgKHBlcmZvcm1hbmNlUmVzdWx0LnJvd3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBwZXJmb3JtYW5jZU1ldHJpY3MgPSB7XHJcbiAgICAgICAgICAgICAgLi4ucGVyZm9ybWFuY2VNZXRyaWNzLFxyXG4gICAgICAgICAgICAgIC4uLnBlcmZvcm1hbmNlUmVzdWx0LnJvd3NbMF1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcGVyZm9ybWFuY2UgbWV0cmljczonLCBlcnJvcik7XHJcbiAgICAgICAgICAvLyBLZWVwIGRlZmF1bHQgcGVyZm9ybWFuY2UgbWV0cmljcyBpZiB0aGVyZSdzIGFuIGVycm9yXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBDb21iaW5lIGFsbCBkYXRhIGFuZCBhZGQgZmFsbGJhY2tzXHJcbiAgICAgIGNvbnN0IGRlYWxEZXRhaWxzID0gYWRkRmFsbGJhY2tEYXRhKHtcclxuICAgICAgICAuLi5kZWFsLFxyXG4gICAgICAgIG1hcmtldF90cmVuZHM6IG1hcmtldFRyZW5kcyxcclxuICAgICAgICBtYXJrZXRfY29tcGFyaXNvbjogbWFya2V0Q29tcGFyaXNvbixcclxuICAgICAgICBwZXJmb3JtYW5jZV9tZXRyaWNzOiBwZXJmb3JtYW5jZU1ldHJpY3NcclxuICAgICAgfSk7XHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oZGVhbERldGFpbHMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgZGVhbCBkZXRhaWxzOicsIGVycm9yKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBkZWFsIGRldGFpbHMnLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG4gIH0gZWxzZSBpZiAocmVxLm1ldGhvZCA9PT0gJ1BVVCcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgXHJcbiAgICAgICAgZGVhbF9uYW1lLCBcclxuICAgICAgICBwcm9wZXJ0eV9uYW1lLCBcclxuICAgICAgICBwcm9wZXJ0eV9hZGRyZXNzLCBcclxuICAgICAgICBjaXR5LCBcclxuICAgICAgICBzdGF0ZSxcclxuICAgICAgICBudW1iZXJfb2Zfcm9vbXMsXHJcbiAgICAgICAgcHJvcGVydHlfdHlwZSwgXHJcbiAgICAgICAgc3RhdHVzXHJcbiAgICAgIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xyXG4gICAgICBpZiAoIWRlYWxfbmFtZSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRGVhbCBuYW1lIGlzIHJlcXVpcmVkJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IGNvbHVtbiBuYW1lcyBmb3IgdGhlIGRlYWxzIHRhYmxlXHJcbiAgICAgIGNvbnN0IGRlYWxDb2x1bW5zUXVlcnkgPSBgXHJcbiAgICAgICAgU0VMRUNUIGNvbHVtbl9uYW1lIFxyXG4gICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgXHJcbiAgICAgICAgV0hFUkUgdGFibGVfc2NoZW1hID0gJ3B1YmxpYycgQU5EIHRhYmxlX25hbWUgPSAnZGVhbHMnXHJcbiAgICAgIGA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBkZWFsQ29sdW1ucyA9IGF3YWl0IHF1ZXJ5KGRlYWxDb2x1bW5zUXVlcnkpO1xyXG4gICAgICBjb25zdCBkZWFsQ29sdW1uTmFtZXMgPSBkZWFsQ29sdW1ucy5yb3dzLm1hcChyb3cgPT4gcm93LmNvbHVtbl9uYW1lKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEJ1aWxkIHRoZSB1cGRhdGUgcXVlcnkgZHluYW1pY2FsbHkgYmFzZWQgb24gYXZhaWxhYmxlIGNvbHVtbnNcclxuICAgICAgY29uc3QgdXBkYXRlRmllbGRzID0gW107XHJcbiAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gW2lkXTsgLy8gRmlyc3QgcGFyYW0gaXMgdGhlIGRlYWwgSURcclxuICAgICAgbGV0IHBhcmFtSW5kZXggPSAyOyAvLyBTdGFydHMgYXQgMiBzaW5jZSAkMSBpcyB1c2VkIGZvciBkZWFsX2lkXHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdkZWFsX25hbWUnKSkge1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKGBkZWFsX25hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XHJcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChkZWFsX25hbWUpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdwcm9wZXJ0eV9uYW1lJykpIHtcclxuICAgICAgICB1cGRhdGVGaWVsZHMucHVzaChgcHJvcGVydHlfbmFtZSA9ICQke3BhcmFtSW5kZXgrK31gKTtcclxuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHByb3BlcnR5X25hbWUpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdwcm9wZXJ0eV9hZGRyZXNzJykpIHtcclxuICAgICAgICB1cGRhdGVGaWVsZHMucHVzaChgcHJvcGVydHlfYWRkcmVzcyA9ICQke3BhcmFtSW5kZXgrK31gKTtcclxuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHByb3BlcnR5X2FkZHJlc3MpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdjaXR5JykpIHtcclxuICAgICAgICB1cGRhdGVGaWVsZHMucHVzaChgY2l0eSA9ICQke3BhcmFtSW5kZXgrK31gKTtcclxuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKGNpdHkpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdzdGF0ZScpKSB7XHJcbiAgICAgICAgdXBkYXRlRmllbGRzLnB1c2goYHN0YXRlID0gJCR7cGFyYW1JbmRleCsrfWApO1xyXG4gICAgICAgIHF1ZXJ5UGFyYW1zLnB1c2goc3RhdGUpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZGVhbENvbHVtbk5hbWVzLmluY2x1ZGVzKCdudW1iZXJfb2Zfcm9vbXMnKSkge1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKGBudW1iZXJfb2Zfcm9vbXMgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XHJcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChudW1iZXJfb2Zfcm9vbXMgPyBwYXJzZUludChudW1iZXJfb2Zfcm9vbXMpIDogbnVsbCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChkZWFsQ29sdW1uTmFtZXMuaW5jbHVkZXMoJ3Byb3BlcnR5X3R5cGUnKSkge1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKGBwcm9wZXJ0eV90eXBlID0gJCR7cGFyYW1JbmRleCsrfWApO1xyXG4gICAgICAgIHF1ZXJ5UGFyYW1zLnB1c2gocHJvcGVydHlfdHlwZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChkZWFsQ29sdW1uTmFtZXMuaW5jbHVkZXMoJ3N0YXR1cycpKSB7XHJcbiAgICAgICAgdXBkYXRlRmllbGRzLnB1c2goYHN0YXR1cyA9ICQke3BhcmFtSW5kZXgrK31gKTtcclxuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHN0YXR1cyk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChkZWFsQ29sdW1uTmFtZXMuaW5jbHVkZXMoJ3VwZGF0ZWRfYXQnKSkge1xyXG4gICAgICAgIHVwZGF0ZUZpZWxkcy5wdXNoKGB1cGRhdGVkX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVBgKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKHVwZGF0ZUZpZWxkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIHZhbGlkIGZpZWxkcyB0byB1cGRhdGUnIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB1cGRhdGVRdWVyeSA9IGBcclxuICAgICAgICBVUERBVEUgZGVhbHMgXHJcbiAgICAgICAgU0VUICR7dXBkYXRlRmllbGRzLmpvaW4oJywgJyl9IFxyXG4gICAgICAgIFdIRVJFIGRlYWxfaWQgPSAkMSBcclxuICAgICAgICBSRVRVUk5JTkcgKmA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZygnVXBkYXRlIHF1ZXJ5OicsIHVwZGF0ZVF1ZXJ5KTtcclxuICAgICAgY29uc29sZS5sb2coJ1F1ZXJ5IHBhcmFtczonLCBxdWVyeVBhcmFtcyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeSh1cGRhdGVRdWVyeSwgcXVlcnlQYXJhbXMpO1xyXG4gICAgICAgIGlmIChyZXN1bHQucm93cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0RlYWwgbm90IGZvdW5kIG9yIGNvdWxkIG5vdCBiZSB1cGRhdGVkJyB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gTG9nIHRoZSBhY3Rpdml0eVxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IHNhdmVBY3Rpdml0eUxvZyh7XHJcbiAgICAgICAgICB1c2VyX2lkOiByZXEudXNlcj8uaWQgfHwgcmVxLnVzZXI/LnVzZXJfaWQgfHwgJ3N5c3RlbScsXHJcbiAgICAgICAgICBhY3Rpb246ICdVUERBVEVfREVBTCcsXHJcbiAgICAgICAgICBlbnRpdHlfdHlwZTogJ0RFQUwnLFxyXG4gICAgICAgICAgZW50aXR5X2lkOiBpZCxcclxuICAgICAgICAgIGRldGFpbHM6IGBVcGRhdGVkIGRlYWwgJHtkZWFsX25hbWV9YFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChsb2dFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgZGVhbCB1cGRhdGUgYWN0aXZpdHk6JywgbG9nRXJyb3IpO1xyXG4gICAgICAgIC8vIENvbnRpbnVlIGV2ZW4gaWYgbG9nZ2luZyBmYWlsc1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXN1bHQucm93c1swXSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBkZWFsOicsIGVycm9yKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byB1cGRhdGUgZGVhbCcsIGRldGFpbHM6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgWydHRVQnLCAnUFVUJ10pO1xyXG4gICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEFkZCBmYWxsYmFjayBkYXRhIGZvciBtaXNzaW5nIGZpZWxkc1xyXG5jb25zdCBhZGRGYWxsYmFja0RhdGEgPSAoZGVhbCkgPT4ge1xyXG4gIC8vIEJhc2ljIGRlYWwgaW5mbyBmYWxsYmFja3NcclxuICBkZWFsLmRlYWxfbmFtZSA9IGRlYWwuZGVhbF9uYW1lIHx8IGAke2RlYWwucHJvcGVydHlfbmFtZSB8fCAnSG90ZWwnfSBJbnZlc3RtZW50YDtcclxuICBkZWFsLmludmVzdG1lbnRfYW1vdW50ID0gZGVhbC5pbnZlc3RtZW50X2Ftb3VudCB8fCAxMDAwMDAwO1xyXG4gIGRlYWwuZXhwZWN0ZWRfcmV0dXJuID0gZGVhbC5leHBlY3RlZF9yZXR1cm4gfHwgOC41O1xyXG4gIGRlYWwuc3RhdHVzID0gZGVhbC5zdGF0dXMgfHwgJ0RyYWZ0JztcclxuICBcclxuICAvLyBQcm9wZXJ0eSBpbmZvIGZhbGxiYWNrc1xyXG4gIGRlYWwucHJvcGVydHlfbmFtZSA9IGRlYWwucHJvcGVydHlfbmFtZSB8fCAnSG90ZWwgUHJvcGVydHknO1xyXG4gIGRlYWwucHJvcGVydHlfYWRkcmVzcyA9IGRlYWwucHJvcGVydHlfYWRkcmVzcyB8fCAnMTIzIE1haW4gU3RyZWV0JztcclxuICBkZWFsLmNpdHlfbmFtZSA9IGRlYWwuY2l0eV9uYW1lIHx8ICdOZXcgWW9yayc7XHJcbiAgZGVhbC5zdGF0ZV9uYW1lID0gZGVhbC5zdGF0ZV9uYW1lIHx8ICdOWSc7XHJcbiAgZGVhbC5ob3RlbF90eXBlX25hbWUgPSBkZWFsLmhvdGVsX3R5cGVfbmFtZSB8fCAnTHV4dXJ5JztcclxuICBcclxuICAvLyBNYXJrZXQgZGF0YSBmYWxsYmFja3NcclxuICBkZWFsLm1hcmtldF9uYW1lID0gZGVhbC5tYXJrZXRfbmFtZSB8fCAnTmV3IFlvcmsnO1xyXG4gIGRlYWwucmVnaW9uX25hbWUgPSBkZWFsLnJlZ2lvbl9uYW1lIHx8ICdOb3J0aGVhc3QnO1xyXG4gIGRlYWwuYnJhbmRfbmFtZSA9IGRlYWwuYnJhbmRfbmFtZSB8fCAnSW5kZXBlbmRlbnQnO1xyXG4gIGRlYWwuY2hhaW5fc2NhbGVfbmFtZSA9IGRlYWwuY2hhaW5fc2NhbGVfbmFtZSB8fCAnVXBzY2FsZSc7XHJcbiAgXHJcbiAgLy8gSWYgbWFya2V0IHRyZW5kcyBkYXRhIGlzIG1pc3Npbmcgb3IgZW1wdHksIGNyZWF0ZSBwbGFjZWhvbGRlciBkYXRhXHJcbiAgaWYgKCFkZWFsLm1hcmtldF90cmVuZHMgfHwgZGVhbC5tYXJrZXRfdHJlbmRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgZGVhbC5tYXJrZXRfdHJlbmRzID0gZ2VuZXJhdGVNb2NrTWFya2V0VHJlbmRzKCk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIElmIG1hcmtldCBjb21wYXJpc29uIGRhdGEgaXMgbWlzc2luZyBvciBlbXB0eSwgY3JlYXRlIHBsYWNlaG9sZGVyIGRhdGFcclxuICBpZiAoIWRlYWwubWFya2V0X2NvbXBhcmlzb24gfHwgZGVhbC5tYXJrZXRfY29tcGFyaXNvbi5sZW5ndGggPT09IDApIHtcclxuICAgIGRlYWwubWFya2V0X2NvbXBhcmlzb24gPSBnZW5lcmF0ZU1vY2tNYXJrZXRDb21wYXJpc29uKCk7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBkZWFsO1xyXG59O1xyXG5cclxuLy8gR2VuZXJhdGUgbW9jayBtYXJrZXQgdHJlbmRzIGRhdGFcclxuY29uc3QgZ2VuZXJhdGVNb2NrTWFya2V0VHJlbmRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IHRyZW5kcyA9IFtdO1xyXG4gIGNvbnN0IGN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xyXG4gIFxyXG4gIGZvciAobGV0IHllYXIgPSBjdXJyZW50WWVhciAtIDQ7IHllYXIgPD0gY3VycmVudFllYXI7IHllYXIrKykge1xyXG4gICAgZm9yIChsZXQgbW9udGggPSAxOyBtb250aCA8PSAxMjsgbW9udGgrKykge1xyXG4gICAgICAvLyBTa2lwIGZ1dHVyZSBtb250aHMgaW4gY3VycmVudCB5ZWFyXHJcbiAgICAgIGlmICh5ZWFyID09PSBjdXJyZW50WWVhciAmJiBtb250aCA+IG5ldyBEYXRlKCkuZ2V0TW9udGgoKSArIDEpIGNvbnRpbnVlO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2FsY3VsYXRlIHNvbWUgcmVhbGlzdGljIHZhbHVlcyB3aXRoIHNlYXNvbmFsIHZhcmlhdGlvbnNcclxuICAgICAgY29uc3Qgc2Vhc29uYWxGYWN0b3IgPSAxICsgTWF0aC5zaW4oKG1vbnRoIC0gMSkgKiBNYXRoLlBJIC8gNikgKiAwLjE1OyAvLyBTZWFzb25hbCB2YXJpYXRpb25cclxuICAgICAgY29uc3QgeWVhckdyb3d0aCA9IDEgKyAoeWVhciAtIChjdXJyZW50WWVhciAtIDQpKSAqIDAuMDU7IC8vIFllYXItb3Zlci15ZWFyIGdyb3d0aFxyXG4gICAgICBcclxuICAgICAgdHJlbmRzLnB1c2goe1xyXG4gICAgICAgIHllYXIsXHJcbiAgICAgICAgbW9udGgsXHJcbiAgICAgICAgcmV2cGFyOiBNYXRoLnJvdW5kKDEwMCAqIHNlYXNvbmFsRmFjdG9yICogeWVhckdyb3d0aCksXHJcbiAgICAgICAgYWRyOiBNYXRoLnJvdW5kKDE1MCAqIHNlYXNvbmFsRmFjdG9yICogeWVhckdyb3d0aCksXHJcbiAgICAgICAgb2NjdXBhbmN5OiBNYXRoLm1pbigwLjk1LCBNYXRoLm1heCgwLjYsIDAuNzUgKiBzZWFzb25hbEZhY3RvciAqIHllYXJHcm93dGgpKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHRyZW5kcztcclxufTtcclxuXHJcbi8vIEdlbmVyYXRlIG1vY2sgbWFya2V0IGNvbXBhcmlzb24gZGF0YVxyXG5jb25zdCBnZW5lcmF0ZU1vY2tNYXJrZXRDb21wYXJpc29uID0gKCkgPT4ge1xyXG4gIHJldHVybiBbXHJcbiAgICB7IG1hcmtldF9uYW1lOiAnTmV3IFlvcmsnLCBhdmdfcmV2cGFyOiAyMTAuNTAsIGF2Z19hZHI6IDI3NS4zMCwgYXZnX29jY3VwYW5jeTogMC43NiB9LFxyXG4gICAgeyBtYXJrZXRfbmFtZTogJ0Jvc3RvbicsIGF2Z19yZXZwYXI6IDE4NS4yNSwgYXZnX2FkcjogMjQ1LjgwLCBhdmdfb2NjdXBhbmN5OiAwLjc1IH0sXHJcbiAgICB7IG1hcmtldF9uYW1lOiAnUGhpbGFkZWxwaGlhJywgYXZnX3JldnBhcjogMTQ1LjgwLCBhdmdfYWRyOiAxOTUuNDAsIGF2Z19vY2N1cGFuY3k6IDAuNzQgfVxyXG4gIF07XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB3aXRoQXV0aChoYW5kbGVyKTsiXSwibmFtZXMiOlsicXVlcnkiLCJzYXZlQWN0aXZpdHlMb2ciLCJ3aXRoQXV0aCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJpZCIsIm1ldGhvZCIsInRhYmxlc1F1ZXJ5IiwidGFibGVzUmVzdWx0IiwiZXhpc3RpbmdUYWJsZXMiLCJyb3dzIiwibWFwIiwicm93IiwidGFibGVfbmFtZSIsImNvbnNvbGUiLCJsb2ciLCJkZWFsUXVlcnkiLCJmcm9tQ2xhdXNlIiwid2hlcmVDbGF1c2UiLCJpbmNsdWRlcyIsInByb3BlcnR5Q29sdW1uc1F1ZXJ5IiwicHJvcGVydHlDb2x1bW5zIiwicHJvcGVydHlDb2x1bW5OYW1lcyIsImNvbHVtbl9uYW1lIiwicHJvcGVydHlJZENvbHVtbiIsImRlYWxDb2x1bW5zUXVlcnkiLCJkZWFsQ29sdW1ucyIsImRlYWxDb2x1bW5OYW1lcyIsImRlYWxQcm9wZXJ0eUNvbHVtbiIsImZpbmFsUXVlcnkiLCJkZWFsUmVzdWx0IiwibGVuZ3RoIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiZGVhbCIsIm1hcmtldFRyZW5kcyIsIm1hcmtldENvbXBhcmlzb24iLCJwZXJmb3JtYW5jZU1ldHJpY3MiLCJyZXZwYXIiLCJhZHIiLCJvY2N1cGFuY3kiLCJjYXBfcmF0ZSIsIm1hcmtldF9rZXkiLCJ0cmVuZHNRdWVyeSIsInRyZW5kc1Jlc3VsdCIsImdlbmVyYXRlTW9ja01hcmtldFRyZW5kcyIsInJlZ2lvbl9rZXkiLCJjb21wYXJpc29uUXVlcnkiLCJjb21wYXJpc29uUmVzdWx0IiwiZ2VuZXJhdGVNb2NrTWFya2V0Q29tcGFyaXNvbiIsInBlcmZvcm1hbmNlUXVlcnkiLCJwZXJmb3JtYW5jZVJlc3VsdCIsImRlYWxEZXRhaWxzIiwiYWRkRmFsbGJhY2tEYXRhIiwibWFya2V0X3RyZW5kcyIsIm1hcmtldF9jb21wYXJpc29uIiwicGVyZm9ybWFuY2VfbWV0cmljcyIsImRldGFpbHMiLCJtZXNzYWdlIiwiZGVhbF9uYW1lIiwicHJvcGVydHlfbmFtZSIsInByb3BlcnR5X2FkZHJlc3MiLCJjaXR5Iiwic3RhdGUiLCJudW1iZXJfb2Zfcm9vbXMiLCJwcm9wZXJ0eV90eXBlIiwiYm9keSIsInVwZGF0ZUZpZWxkcyIsInF1ZXJ5UGFyYW1zIiwicGFyYW1JbmRleCIsInB1c2giLCJwYXJzZUludCIsInVwZGF0ZVF1ZXJ5Iiwiam9pbiIsInJlc3VsdCIsInVzZXJfaWQiLCJ1c2VyIiwiYWN0aW9uIiwiZW50aXR5X3R5cGUiLCJlbnRpdHlfaWQiLCJsb2dFcnJvciIsInNldEhlYWRlciIsImVuZCIsImludmVzdG1lbnRfYW1vdW50IiwiZXhwZWN0ZWRfcmV0dXJuIiwiY2l0eV9uYW1lIiwic3RhdGVfbmFtZSIsImhvdGVsX3R5cGVfbmFtZSIsIm1hcmtldF9uYW1lIiwicmVnaW9uX25hbWUiLCJicmFuZF9uYW1lIiwiY2hhaW5fc2NhbGVfbmFtZSIsInRyZW5kcyIsImN1cnJlbnRZZWFyIiwiRGF0ZSIsImdldEZ1bGxZZWFyIiwieWVhciIsIm1vbnRoIiwiZ2V0TW9udGgiLCJzZWFzb25hbEZhY3RvciIsIk1hdGgiLCJzaW4iLCJQSSIsInllYXJHcm93dGgiLCJyb3VuZCIsIm1pbiIsIm1heCIsImF2Z19yZXZwYXIiLCJhdmdfYWRyIiwiYXZnX29jY3VwYW5jeSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/deals/[id].js\n");

/***/ }),

/***/ "(api-node)/./utils/activityLogger.js":
/*!*********************************!*\
  !*** ./utils/activityLogger.js ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getEntityActivityLogs: () => (/* binding */ getEntityActivityLogs),\n/* harmony export */   saveActivityLog: () => (/* binding */ saveActivityLog)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// Utility for logging user activities\n\n/**\r\n * Save an activity log entry\r\n * @param {Object} logData - The activity data to log\r\n * @param {string} logData.user_id - The ID of the user performing the action\r\n * @param {string} logData.action - The type of action (e.g., CREATE_DEAL, UPDATE_DEAL, etc.)\r\n * @param {string} logData.entity_type - The type of entity being acted upon (e.g., DEAL, PROPERTY, etc.)\r\n * @param {string} logData.entity_id - The ID of the entity being acted upon\r\n * @param {string} logData.details - Additional details about the action\r\n * @returns {Promise} - A promise that resolves to the API response\r\n */ const saveActivityLog = async (logData)=>{\n    try {\n        const { user_id, action, entity_type, entity_id, details } = logData;\n        // Basic validation\n        if (!user_id || !action || !entity_type || !entity_id) {\n            throw new Error('Missing required fields for activity log');\n        }\n        // Log to database\n        const response = await fetch('/api/activity-log', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                user_id,\n                action,\n                entity_type,\n                entity_id,\n                details,\n                timestamp: new Date().toISOString()\n            })\n        });\n        return response.data;\n    } catch (error) {\n        // Just log the error but don't fail the main operation\n        console.error('Error logging activity:', error);\n        return {\n            success: false,\n            error: error.message\n        };\n    }\n};\n/**\r\n * Get activity logs for a specific entity\r\n * @param {string} entityType - The type of entity (e.g., DEAL, PROPERTY)\r\n * @param {string} entityId - The ID of the entity\r\n * @returns {Promise} - A promise that resolves to the activity logs\r\n */ const getEntityActivityLogs = async (entityType, entityId)=>{\n    try {\n        const response = await fetch(`/api/activity-log?entity_type=${entityType}&entity_id=${entityId}`);\n        if (!response.ok) {\n            throw new Error('Failed to fetch activity logs');\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Error fetching activity logs:', error);\n        throw error;\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3V0aWxzL2FjdGl2aXR5TG9nZ2VyLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHNDQUFzQztBQUNaO0FBRTFCOzs7Ozs7Ozs7Q0FTQyxHQUNNLE1BQU1DLGtCQUFrQixPQUFPQztJQUNwQyxJQUFJO1FBQ0YsTUFBTSxFQUFFQyxPQUFPLEVBQUVDLE1BQU0sRUFBRUMsV0FBVyxFQUFFQyxTQUFTLEVBQUVDLE9BQU8sRUFBRSxHQUFHTDtRQUU3RCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDQyxXQUFXLENBQUNDLFVBQVUsQ0FBQ0MsZUFBZSxDQUFDQyxXQUFXO1lBQ3JELE1BQU0sSUFBSUUsTUFBTTtRQUNsQjtRQUVBLGtCQUFrQjtRQUNsQixNQUFNQyxXQUFXLE1BQU1DLE1BQU0scUJBQXFCO1lBQ2hEQyxRQUFRO1lBQ1JDLFNBQVM7Z0JBQ1AsZ0JBQWdCO1lBQ2xCO1lBQ0FDLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztnQkFDbkJaO2dCQUNBQztnQkFDQUM7Z0JBQ0FDO2dCQUNBQztnQkFDQVMsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO1lBQ25DO1FBQ0Y7UUFFQSxPQUFPVCxTQUFTVSxJQUFJO0lBQ3RCLEVBQUUsT0FBT0MsT0FBTztRQUNkLHVEQUF1RDtRQUN2REMsUUFBUUQsS0FBSyxDQUFDLDJCQUEyQkE7UUFDekMsT0FBTztZQUFFRSxTQUFTO1lBQU9GLE9BQU9BLE1BQU1HLE9BQU87UUFBQztJQUNoRDtBQUNGLEVBQUU7QUFFRjs7Ozs7Q0FLQyxHQUNNLE1BQU1DLHdCQUF3QixPQUFPQyxZQUFZQztJQUN0RCxJQUFJO1FBQ0YsTUFBTWpCLFdBQVcsTUFBTUMsTUFBTSxDQUFDLDhCQUE4QixFQUFFZSxXQUFXLFdBQVcsRUFBRUMsVUFBVTtRQUNoRyxJQUFJLENBQUNqQixTQUFTa0IsRUFBRSxFQUFFO1lBQ2hCLE1BQU0sSUFBSW5CLE1BQU07UUFDbEI7UUFDQSxPQUFPLE1BQU1DLFNBQVNtQixJQUFJO0lBQzVCLEVBQUUsT0FBT1IsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxNQUFNQTtJQUNSO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsiQzpcXHZpbm9kXFxwcm9qZWN0c1xcaW5udmVzdFxcUE9DXFxpbm52ZXN0YWlcXHV0aWxzXFxhY3Rpdml0eUxvZ2dlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBVdGlsaXR5IGZvciBsb2dnaW5nIHVzZXIgYWN0aXZpdGllc1xyXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xyXG5cclxuLyoqXHJcbiAqIFNhdmUgYW4gYWN0aXZpdHkgbG9nIGVudHJ5XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBsb2dEYXRhIC0gVGhlIGFjdGl2aXR5IGRhdGEgdG8gbG9nXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2dEYXRhLnVzZXJfaWQgLSBUaGUgSUQgb2YgdGhlIHVzZXIgcGVyZm9ybWluZyB0aGUgYWN0aW9uXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2dEYXRhLmFjdGlvbiAtIFRoZSB0eXBlIG9mIGFjdGlvbiAoZS5nLiwgQ1JFQVRFX0RFQUwsIFVQREFURV9ERUFMLCBldGMuKVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9nRGF0YS5lbnRpdHlfdHlwZSAtIFRoZSB0eXBlIG9mIGVudGl0eSBiZWluZyBhY3RlZCB1cG9uIChlLmcuLCBERUFMLCBQUk9QRVJUWSwgZXRjLilcclxuICogQHBhcmFtIHtzdHJpbmd9IGxvZ0RhdGEuZW50aXR5X2lkIC0gVGhlIElEIG9mIHRoZSBlbnRpdHkgYmVpbmcgYWN0ZWQgdXBvblxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9nRGF0YS5kZXRhaWxzIC0gQWRkaXRpb25hbCBkZXRhaWxzIGFib3V0IHRoZSBhY3Rpb25cclxuICogQHJldHVybnMge1Byb21pc2V9IC0gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gdGhlIEFQSSByZXNwb25zZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHNhdmVBY3Rpdml0eUxvZyA9IGFzeW5jIChsb2dEYXRhKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcl9pZCwgYWN0aW9uLCBlbnRpdHlfdHlwZSwgZW50aXR5X2lkLCBkZXRhaWxzIH0gPSBsb2dEYXRhO1xyXG4gICAgXHJcbiAgICAvLyBCYXNpYyB2YWxpZGF0aW9uXHJcbiAgICBpZiAoIXVzZXJfaWQgfHwgIWFjdGlvbiB8fCAhZW50aXR5X3R5cGUgfHwgIWVudGl0eV9pZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzIGZvciBhY3Rpdml0eSBsb2cnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gTG9nIHRvIGRhdGFiYXNlXHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2FjdGl2aXR5LWxvZycsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICB1c2VyX2lkLFxyXG4gICAgICAgIGFjdGlvbixcclxuICAgICAgICBlbnRpdHlfdHlwZSxcclxuICAgICAgICBlbnRpdHlfaWQsXHJcbiAgICAgICAgZGV0YWlscyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAvLyBKdXN0IGxvZyB0aGUgZXJyb3IgYnV0IGRvbid0IGZhaWwgdGhlIG1haW4gb3BlcmF0aW9uXHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2dnaW5nIGFjdGl2aXR5OicsIGVycm9yKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgYWN0aXZpdHkgbG9ncyBmb3IgYSBzcGVjaWZpYyBlbnRpdHlcclxuICogQHBhcmFtIHtzdHJpbmd9IGVudGl0eVR5cGUgLSBUaGUgdHlwZSBvZiBlbnRpdHkgKGUuZy4sIERFQUwsIFBST1BFUlRZKVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gZW50aXR5SWQgLSBUaGUgSUQgb2YgdGhlIGVudGl0eVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byB0aGUgYWN0aXZpdHkgbG9nc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldEVudGl0eUFjdGl2aXR5TG9ncyA9IGFzeW5jIChlbnRpdHlUeXBlLCBlbnRpdHlJZCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAvYXBpL2FjdGl2aXR5LWxvZz9lbnRpdHlfdHlwZT0ke2VudGl0eVR5cGV9JmVudGl0eV9pZD0ke2VudGl0eUlkfWApO1xyXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBhY3Rpdml0eSBsb2dzJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBhY3Rpdml0eSBsb2dzOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuIl0sIm5hbWVzIjpbImF4aW9zIiwic2F2ZUFjdGl2aXR5TG9nIiwibG9nRGF0YSIsInVzZXJfaWQiLCJhY3Rpb24iLCJlbnRpdHlfdHlwZSIsImVudGl0eV9pZCIsImRldGFpbHMiLCJFcnJvciIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJnZXRFbnRpdHlBY3Rpdml0eUxvZ3MiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJvayIsImpzb24iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./utils/activityLogger.js\n");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "react":
/*!************************!*\
  !*** external "react" ***!
  \************************/
/***/ ((module) => {

module.exports = require("react");

/***/ }),

/***/ "uuid":
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("uuid");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdeals%5C%5Bid%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();