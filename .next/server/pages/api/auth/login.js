"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth/login";
exports.ids = ["pages/api/auth/login"];
exports.modules = {

/***/ "(api-node)/./lib/auth.js":
/*!*********************!*\
  !*** ./lib/auth.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   accountManager: () => (/* binding */ accountManager),\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   clientAccountManager: () => (/* binding */ clientAccountManager),\n/* harmony export */   clientAuth: () => (/* binding */ clientAuth)\n/* harmony export */ });\n// lib/auth.js\n// Declare variables to hold modules\nlet bcrypt;\nlet uuidv4;\nlet queryFn;\nlet poolObj;\n// Only initialize on the server\nif (true) {\n    try {\n        // Server-side imports\n        bcrypt = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n        const { v4 } = __webpack_require__(/*! uuid */ \"uuid\");\n        uuidv4 = v4;\n        // Import database functions - using dynamic import to avoid webpack issues\n        const dbModule = __webpack_require__(/*! ./db.js */ \"(api-node)/./lib/db.js\");\n        queryFn = dbModule.query;\n        poolObj = dbModule.pool;\n    } catch (error) {\n        console.error('Error initializing auth module:', error);\n        // Provide fallbacks if imports fail\n        bcrypt = {\n            hash: async ()=>'hash-function-not-available',\n            compare: async ()=>false\n        };\n        uuidv4 = ()=>'uuid-function-not-available';\n        queryFn = async ()=>{\n            throw new Error('Database query function not available');\n        };\n        poolObj = {\n            query: async ()=>{\n                throw new Error('Database pool not available');\n            }\n        };\n    }\n} else {}\n// Simple session-based authentication\nconst auth = {\n    // Create a hashed password\n    async hashPassword (password) {\n        // Can run on client or server, but only does real work on server\n        if (false) {}\n        return await bcrypt.hash(password, 10);\n    },\n    // Compare password with hash\n    async comparePassword (password, hash) {\n        // Can run on client or server, but only does real work on server\n        if (false) {}\n        return await bcrypt.compare(password, hash);\n    },\n    // Find user by email - server only\n    async findUserByEmail (email) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn(`SELECT u.*, a.account_name, a.is_active as account_is_active, r.role_name \n         FROM users u\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE u.email = $1`, [\n                email\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error finding user by email:', error);\n            throw error;\n        }\n    },\n    // Find user by ID - server only\n    async findUserById (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn(`SELECT u.*, a.account_name, a.is_active as account_is_active, r.role_name, r.permissions\n         FROM users u\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE u.user_id = $1`, [\n                userId\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error finding user by ID:', error);\n            throw error;\n        }\n    },\n    // Create a new session - server only\n    async createSession (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        const sessionToken = uuidv4();\n        const expiresAt = new Date();\n        expiresAt.setDate(expiresAt.getDate() + 7); // 7 days expiration\n        try {\n            await queryFn('INSERT INTO sessions (user_id, session_token, expires_at) VALUES ($1, $2, $3)', [\n                userId,\n                sessionToken,\n                expiresAt\n            ]);\n            return sessionToken;\n        } catch (error) {\n            console.error('Error creating session:', error);\n            throw error;\n        }\n    },\n    // Verify a session token - server only\n    async verifySession (sessionToken) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn(`SELECT u.*, s.session_id, s.expires_at, a.account_name, a.is_active as account_is_active, r.role_name, r.permissions\n         FROM sessions s\n         JOIN users u ON s.user_id = u.user_id\n         JOIN accounts a ON u.account_id = a.account_id\n         JOIN roles r ON u.role_id = r.role_id\n         WHERE s.session_token = $1 AND s.expires_at > NOW()`, [\n                sessionToken\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error verifying session:', error);\n            throw error;\n        }\n    },\n    // Invalidate a session - server only\n    async invalidateSession (sessionToken) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            await queryFn('DELETE FROM sessions WHERE session_token = $1', [\n                sessionToken\n            ]);\n            return true;\n        } catch (error) {\n            console.error('Error invalidating session:', error);\n            throw error;\n        }\n    },\n    // Create a password reset token - server only\n    async createPasswordResetToken (userId) {\n        // Ensure we're running on the server\n        if (false) {}\n        const token = uuidv4();\n        const expiresAt = new Date();\n        expiresAt.setHours(expiresAt.getHours() + 24); // 24 hours expiration\n        try {\n            await queryFn('INSERT INTO password_reset_tokens (user_id, token, expires_at) VALUES ($1, $2, $3)', [\n                userId,\n                token,\n                expiresAt\n            ]);\n            return token;\n        } catch (error) {\n            console.error('Error creating password reset token:', error);\n            throw error;\n        }\n    },\n    // Verify a password reset token - server only\n    async verifyResetToken (token) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const result = await queryFn('SELECT * FROM password_reset_tokens WHERE token = $1 AND expires_at > NOW()', [\n                token\n            ]);\n            return result.rows[0] || null;\n        } catch (error) {\n            console.error('Error verifying reset token:', error);\n            throw error;\n        }\n    },\n    // Reset password - server only\n    async resetPassword (token, newPassword) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            const tokenRecord = await this.verifyResetToken(token);\n            if (!tokenRecord) {\n                return {\n                    success: false,\n                    error: 'Invalid or expired token'\n                };\n            }\n            const passwordHash = await this.hashPassword(newPassword);\n            // Update password\n            await queryFn('UPDATE users SET password_hash = $1, updated_at = NOW() WHERE user_id = $2', [\n                passwordHash,\n                tokenRecord.user_id\n            ]);\n            // Delete the token\n            await queryFn('DELETE FROM password_reset_tokens WHERE token_id = $1', [\n                tokenRecord.token_id\n            ]);\n            return {\n                success: true\n            };\n        } catch (error) {\n            console.error('Error resetting password:', error);\n            throw error;\n        }\n    }\n};\n// Account management - all methods are server-only\nconst accountManager = {\n    // Create a new account with admin user\n    async createAccount (accountData, userData) {\n        // Ensure we're running on the server\n        if (false) {}\n        try {\n            // Start a transaction\n            await queryFn('BEGIN');\n            // Create account\n            const accountResult = await queryFn('INSERT INTO accounts (account_name, account_domain, plan_id, billing_email) VALUES ($1, $2, $3, $4) RETURNING *', [\n                accountData.accountName,\n                accountData.accountDomain || null,\n                accountData.planId || 1,\n                accountData.billingEmail\n            ]);\n            const account = accountResult.rows[0];\n            // Hash password\n            const passwordHash = await auth.hashPassword(userData.password);\n            // Create admin user (role_id 1 = Admin)\n            const userResult = await queryFn(`INSERT INTO users (account_id, email, password_hash, first_name, last_name, role_id, is_account_admin) \n         VALUES ($1, $2, $3, $4, $5, 1, TRUE) RETURNING *`, [\n                account.account_id,\n                userData.email,\n                passwordHash,\n                userData.firstName,\n                userData.lastName\n            ]);\n            const admin = userResult.rows[0];\n            // Commit transaction\n            await queryFn('COMMIT');\n            return {\n                account,\n                admin\n            };\n        } catch (error) {\n            // Rollback transaction on error\n            await queryFn('ROLLBACK');\n            console.error('Error creating account:', error);\n            throw error;\n        }\n    }\n};\n// Create mock implementations for client-side use\nconst createMockAuth = ()=>{\n    const mockAuth = {\n        // Mock implementations that are safe to use on the client\n        async hashPassword (password) {\n            if (true) {\n                // When running on the server, use the real implementation\n                return auth.hashPassword(password);\n            }\n            // On client, just return a placeholder (real hashing happens server-side)\n            console.warn('hashPassword called on client, real hashing will happen server-side');\n            return `mock-hash-${password.length}`;\n        },\n        async comparePassword (password, hash) {\n            if (true) {\n                // When running on the server, use the real implementation\n                return auth.comparePassword(password, hash);\n            }\n            // On client, just return a placeholder (real comparison happens server-side)\n            console.warn('comparePassword called on client, real comparison will happen server-side');\n            return false;\n        },\n        // These methods should be called via API endpoints on the client\n        async findUserByEmail () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async findUserById () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createSession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async verifySession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async invalidateSession () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createPasswordResetToken () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async verifyResetToken () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async resetPassword () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        }\n    };\n    return mockAuth;\n};\n// Create a mock account manager for client-side use\nconst createMockAccountManager = ()=>{\n    const mockAccountManager = {\n        // All methods should be called via API endpoints on the client\n        async createAccount () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async getAccountUsers () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async createUser () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async updateUser () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        },\n        async updateAccount () {\n            throw new Error('This method should be called via an API endpoint on client-side');\n        }\n    };\n    return mockAccountManager;\n};\n// Export the appropriate implementations based on environment\nconst clientAuth =  false ? 0 : auth;\nconst clientAccountManager =  false ? 0 : accountManager;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWlFO1FBQ2pFLE1BQU1HO1lBQ0osTUFBTSxJQUFJUCxNQUFNO1FBQ2xCO1FBRUEsTUFBTVc7WUFDSixNQUFNLElBQUlYLE1BQU07UUFDbEI7UUFFQSxNQUFNYTtZQUNKLE1BQU0sSUFBSWIsTUFBTTtRQUNsQjtRQUVBLE1BQU1tQjtZQUNKLE1BQU0sSUFBSW5CLE1BQU07UUFDbEI7UUFFQSxNQUFNb0I7WUFDSixNQUFNLElBQUlwQixNQUFNO1FBQ2xCO1FBRUEsTUFBTXFCO1lBQ0osTUFBTSxJQUFJckIsTUFBTTtRQUNsQjtRQUVBLE1BQU15QjtZQUNKLE1BQU0sSUFBSXpCLE1BQU07UUFDbEI7UUFFQSxNQUFNMEI7WUFDSixNQUFNLElBQUkxQixNQUFNO1FBQ2xCO0lBQ0Y7SUFFQSxPQUFPaUQ7QUFDVDtBQUVBLG9EQUFvRDtBQUNwRCxNQUFNQywyQkFBMkI7SUFDL0IsTUFBTUMscUJBQXFCO1FBQ3pCLCtEQUErRDtRQUMvRCxNQUFNakI7WUFDSixNQUFNLElBQUlsQyxNQUFNO1FBQ2xCO1FBRUEsTUFBTW9EO1lBQ0osTUFBTSxJQUFJcEQsTUFBTTtRQUNsQjtRQUVBLE1BQU1xRDtZQUNKLE1BQU0sSUFBSXJELE1BQU07UUFDbEI7UUFFQSxNQUFNc0Q7WUFDSixNQUFNLElBQUl0RCxNQUFNO1FBQ2xCO1FBRUEsTUFBTXVEO1lBQ0osTUFBTSxJQUFJdkQsTUFBTTtRQUNsQjtJQUNGO0lBRUEsT0FBT21EO0FBQ1Q7QUFFQSw4REFBOEQ7QUFDdkQsTUFBTUssYUFBYSxNQUE2QixHQUFHUixDQUFnQkEsR0FBRy9DLEtBQUs7QUFDM0UsTUFBTXdELHVCQUF1QixNQUE2QixHQUFHUCxDQUEwQkEsR0FBR2pCLGVBQWUiLCJzb3VyY2VzIjpbIkM6XFx2aW5vZFxccHJvamVjdHNcXGlubnZlc3RcXFBPQ1xcaW5udmVzdGFpXFxsaWJcXGF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL2F1dGguanNcclxuXHJcbi8vIERlY2xhcmUgdmFyaWFibGVzIHRvIGhvbGQgbW9kdWxlc1xyXG5sZXQgYmNyeXB0O1xyXG5sZXQgdXVpZHY0O1xyXG5sZXQgcXVlcnlGbjtcclxubGV0IHBvb2xPYmo7XHJcblxyXG4vLyBPbmx5IGluaXRpYWxpemUgb24gdGhlIHNlcnZlclxyXG5pZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICB0cnkge1xyXG4gICAgLy8gU2VydmVyLXNpZGUgaW1wb3J0c1xyXG4gICAgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKTtcclxuICAgIGNvbnN0IHsgdjQgfSA9IHJlcXVpcmUoJ3V1aWQnKTtcclxuICAgIHV1aWR2NCA9IHY0O1xyXG4gICAgXHJcbiAgICAvLyBJbXBvcnQgZGF0YWJhc2UgZnVuY3Rpb25zIC0gdXNpbmcgZHluYW1pYyBpbXBvcnQgdG8gYXZvaWQgd2VicGFjayBpc3N1ZXNcclxuICAgIGNvbnN0IGRiTW9kdWxlID0gcmVxdWlyZSgnLi9kYi5qcycpO1xyXG4gICAgcXVlcnlGbiA9IGRiTW9kdWxlLnF1ZXJ5O1xyXG4gICAgcG9vbE9iaiA9IGRiTW9kdWxlLnBvb2w7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBhdXRoIG1vZHVsZTonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIC8vIFByb3ZpZGUgZmFsbGJhY2tzIGlmIGltcG9ydHMgZmFpbFxyXG4gICAgYmNyeXB0ID0ge1xyXG4gICAgICBoYXNoOiBhc3luYyAoKSA9PiAnaGFzaC1mdW5jdGlvbi1ub3QtYXZhaWxhYmxlJyxcclxuICAgICAgY29tcGFyZTogYXN5bmMgKCkgPT4gZmFsc2VcclxuICAgIH07XHJcbiAgICB1dWlkdjQgPSAoKSA9PiAndXVpZC1mdW5jdGlvbi1ub3QtYXZhaWxhYmxlJztcclxuICAgIHF1ZXJ5Rm4gPSBhc3luYyAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcnkgZnVuY3Rpb24gbm90IGF2YWlsYWJsZScpOyB9O1xyXG4gICAgcG9vbE9iaiA9IHsgcXVlcnk6IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBwb29sIG5vdCBhdmFpbGFibGUnKTsgfSB9O1xyXG4gIH1cclxufSBlbHNlIHtcclxuICAvLyBDbGllbnQtc2lkZSBzdHVic1xyXG4gIGJjcnlwdCA9IHtcclxuICAgIGhhc2g6IGFzeW5jICgpID0+ICdjbGllbnQtc2lkZS1zdHViLWhhc2gnLFxyXG4gICAgY29tcGFyZTogYXN5bmMgKCkgPT4gZmFsc2VcclxuICB9O1xyXG4gIHV1aWR2NCA9ICgpID0+ICdjbGllbnQtc2lkZS1zdHViLXV1aWQnO1xyXG4gIHF1ZXJ5Rm4gPSBhc3luYyAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcmllcyBjYW5ub3QgYmUgZXhlY3V0ZWQgb24gdGhlIGNsaWVudCBzaWRlJyk7IH07XHJcbiAgcG9vbE9iaiA9IHsgcXVlcnk6IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBwb29sIGNhbm5vdCBiZSB1c2VkIG9uIHRoZSBjbGllbnQgc2lkZScpOyB9IH07XHJcbn1cclxuXHJcbi8vIFNpbXBsZSBzZXNzaW9uLWJhc2VkIGF1dGhlbnRpY2F0aW9uXHJcbmV4cG9ydCBjb25zdCBhdXRoID0ge1xyXG4gIC8vIENyZWF0ZSBhIGhhc2hlZCBwYXNzd29yZFxyXG4gIGFzeW5jIGhhc2hQYXNzd29yZChwYXNzd29yZCkge1xyXG4gICAgLy8gQ2FuIHJ1biBvbiBjbGllbnQgb3Igc2VydmVyLCBidXQgb25seSBkb2VzIHJlYWwgd29yayBvbiBzZXJ2ZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ2hhc2hQYXNzd29yZCBjYWxsZWQgb24gY2xpZW50LCByZWFsIGhhc2hpbmcgd2lsbCBoYXBwZW4gc2VydmVyLXNpZGUnKTtcclxuICAgICAgcmV0dXJuIGBtb2NrLWhhc2gtJHtwYXNzd29yZC5sZW5ndGh9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApO1xyXG4gIH0sXHJcblxyXG4gIC8vIENvbXBhcmUgcGFzc3dvcmQgd2l0aCBoYXNoXHJcbiAgYXN5bmMgY29tcGFyZVBhc3N3b3JkKHBhc3N3b3JkLCBoYXNoKSB7XHJcbiAgICAvLyBDYW4gcnVuIG9uIGNsaWVudCBvciBzZXJ2ZXIsIGJ1dCBvbmx5IGRvZXMgcmVhbCB3b3JrIG9uIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignY29tcGFyZVBhc3N3b3JkIGNhbGxlZCBvbiBjbGllbnQsIHJlYWwgY29tcGFyaXNvbiB3aWxsIGhhcHBlbiBzZXJ2ZXItc2lkZScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2gpO1xyXG4gIH0sXHJcblxyXG4gIC8vIEZpbmQgdXNlciBieSBlbWFpbCAtIHNlcnZlciBvbmx5XHJcbiAgYXN5bmMgZmluZFVzZXJCeUVtYWlsKGVtYWlsKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeUZuKFxyXG4gICAgICAgIGBTRUxFQ1QgdS4qLCBhLmFjY291bnRfbmFtZSwgYS5pc19hY3RpdmUgYXMgYWNjb3VudF9pc19hY3RpdmUsIHIucm9sZV9uYW1lIFxyXG4gICAgICAgICBGUk9NIHVzZXJzIHVcclxuICAgICAgICAgSk9JTiBhY2NvdW50cyBhIE9OIHUuYWNjb3VudF9pZCA9IGEuYWNjb3VudF9pZFxyXG4gICAgICAgICBKT0lOIHJvbGVzIHIgT04gdS5yb2xlX2lkID0gci5yb2xlX2lkXHJcbiAgICAgICAgIFdIRVJFIHUuZW1haWwgPSAkMWAsXHJcbiAgICAgICAgW2VtYWlsXVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdIHx8IG51bGw7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmaW5kaW5nIHVzZXIgYnkgZW1haWw6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBGaW5kIHVzZXIgYnkgSUQgLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIGZpbmRVc2VyQnlJZCh1c2VySWQpIHtcclxuICAgIC8vIEVuc3VyZSB3ZSdyZSBydW5uaW5nIG9uIHRoZSBzZXJ2ZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIHRoZSBzZXJ2ZXIgc2lkZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgYFNFTEVDVCB1LiosIGEuYWNjb3VudF9uYW1lLCBhLmlzX2FjdGl2ZSBhcyBhY2NvdW50X2lzX2FjdGl2ZSwgci5yb2xlX25hbWUsIHIucGVybWlzc2lvbnNcclxuICAgICAgICAgRlJPTSB1c2VycyB1XHJcbiAgICAgICAgIEpPSU4gYWNjb3VudHMgYSBPTiB1LmFjY291bnRfaWQgPSBhLmFjY291bnRfaWRcclxuICAgICAgICAgSk9JTiByb2xlcyByIE9OIHUucm9sZV9pZCA9IHIucm9sZV9pZFxyXG4gICAgICAgICBXSEVSRSB1LnVzZXJfaWQgPSAkMWAsXHJcbiAgICAgICAgW3VzZXJJZF1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmluZGluZyB1c2VyIGJ5IElEOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLy8gQ3JlYXRlIGEgbmV3IHNlc3Npb24gLSBzZXJ2ZXIgb25seVxyXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24odXNlcklkKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSB1dWlkdjQoKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBleHBpcmVzQXQuc2V0RGF0ZShleHBpcmVzQXQuZ2V0RGF0ZSgpICsgNyk7IC8vIDcgZGF5cyBleHBpcmF0aW9uXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgcXVlcnlGbihcclxuICAgICAgICAnSU5TRVJUIElOVE8gc2Vzc2lvbnMgKHVzZXJfaWQsIHNlc3Npb25fdG9rZW4sIGV4cGlyZXNfYXQpIFZBTFVFUyAoJDEsICQyLCAkMyknLFxyXG4gICAgICAgIFt1c2VySWQsIHNlc3Npb25Ub2tlbiwgZXhwaXJlc0F0XVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHNlc3Npb25Ub2tlbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHNlc3Npb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBWZXJpZnkgYSBzZXNzaW9uIHRva2VuIC0gc2VydmVyIG9ubHlcclxuICBhc3luYyB2ZXJpZnlTZXNzaW9uKHNlc3Npb25Ub2tlbikge1xyXG4gICAgLy8gRW5zdXJlIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gdGhlIHNlcnZlciBzaWRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVlcnlGbihcclxuICAgICAgICBgU0VMRUNUIHUuKiwgcy5zZXNzaW9uX2lkLCBzLmV4cGlyZXNfYXQsIGEuYWNjb3VudF9uYW1lLCBhLmlzX2FjdGl2ZSBhcyBhY2NvdW50X2lzX2FjdGl2ZSwgci5yb2xlX25hbWUsIHIucGVybWlzc2lvbnNcclxuICAgICAgICAgRlJPTSBzZXNzaW9ucyBzXHJcbiAgICAgICAgIEpPSU4gdXNlcnMgdSBPTiBzLnVzZXJfaWQgPSB1LnVzZXJfaWRcclxuICAgICAgICAgSk9JTiBhY2NvdW50cyBhIE9OIHUuYWNjb3VudF9pZCA9IGEuYWNjb3VudF9pZFxyXG4gICAgICAgICBKT0lOIHJvbGVzIHIgT04gdS5yb2xlX2lkID0gci5yb2xlX2lkXHJcbiAgICAgICAgIFdIRVJFIHMuc2Vzc2lvbl90b2tlbiA9ICQxIEFORCBzLmV4cGlyZXNfYXQgPiBOT1coKWAsXHJcbiAgICAgICAgW3Nlc3Npb25Ub2tlbl1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdmVyaWZ5aW5nIHNlc3Npb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBJbnZhbGlkYXRlIGEgc2Vzc2lvbiAtIHNlcnZlciBvbmx5XHJcbiAgYXN5bmMgaW52YWxpZGF0ZVNlc3Npb24oc2Vzc2lvblRva2VuKSB7XHJcbiAgICAvLyBFbnN1cmUgd2UncmUgcnVubmluZyBvbiB0aGUgc2VydmVyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiB0aGUgc2VydmVyIHNpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBxdWVyeUZuKCdERUxFVEUgRlJPTSBzZXNzaW9ucyBXSEVSRSBzZXNzaW9uX3Rva2VuID0gJDEnLCBbc2Vzc2lvblRva2VuXSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW52YWxpZGF0aW5nIHNlc3Npb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBDcmVhdGUgYSBwYXNzd29yZCByZXNldCB0b2tlbiAtIHNlcnZlciBvbmx5XHJcbiAgYXN5bmMgY3JlYXRlUGFzc3dvcmRSZXNldFRva2VuKHVzZXJJZCkge1xyXG4gICAgLy8gRW5zdXJlIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gdGhlIHNlcnZlciBzaWRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9rZW4gPSB1dWlkdjQoKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBleHBpcmVzQXQuc2V0SG91cnMoZXhwaXJlc0F0LmdldEhvdXJzKCkgKyAyNCk7IC8vIDI0IGhvdXJzIGV4cGlyYXRpb25cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBxdWVyeUZuKFxyXG4gICAgICAgICdJTlNFUlQgSU5UTyBwYXNzd29yZF9yZXNldF90b2tlbnMgKHVzZXJfaWQsIHRva2VuLCBleHBpcmVzX2F0KSBWQUxVRVMgKCQxLCAkMiwgJDMpJyxcclxuICAgICAgICBbdXNlcklkLCB0b2tlbiwgZXhwaXJlc0F0XVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHRva2VuO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcGFzc3dvcmQgcmVzZXQgdG9rZW46JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBWZXJpZnkgYSBwYXNzd29yZCByZXNldCB0b2tlbiAtIHNlcnZlciBvbmx5XHJcbiAgYXN5bmMgdmVyaWZ5UmVzZXRUb2tlbih0b2tlbikge1xyXG4gICAgLy8gRW5zdXJlIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gdGhlIHNlcnZlciBzaWRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVlcnlGbihcclxuICAgICAgICAnU0VMRUNUICogRlJPTSBwYXNzd29yZF9yZXNldF90b2tlbnMgV0hFUkUgdG9rZW4gPSAkMSBBTkQgZXhwaXJlc19hdCA+IE5PVygpJyxcclxuICAgICAgICBbdG9rZW5dXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0LnJvd3NbMF0gfHwgbnVsbDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHZlcmlmeWluZyByZXNldCB0b2tlbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIFJlc2V0IHBhc3N3b3JkIC0gc2VydmVyIG9ubHlcclxuICBhc3luYyByZXNldFBhc3N3b3JkKHRva2VuLCBuZXdQYXNzd29yZCkge1xyXG4gICAgLy8gRW5zdXJlIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gdGhlIHNlcnZlciBzaWRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdG9rZW5SZWNvcmQgPSBhd2FpdCB0aGlzLnZlcmlmeVJlc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgaWYgKCF0b2tlblJlY29yZCkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgb3IgZXhwaXJlZCB0b2tlbicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcGFzc3dvcmRIYXNoID0gYXdhaXQgdGhpcy5oYXNoUGFzc3dvcmQobmV3UGFzc3dvcmQpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIHBhc3N3b3JkXHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgJ1VQREFURSB1c2VycyBTRVQgcGFzc3dvcmRfaGFzaCA9ICQxLCB1cGRhdGVkX2F0ID0gTk9XKCkgV0hFUkUgdXNlcl9pZCA9ICQyJyxcclxuICAgICAgICBbcGFzc3dvcmRIYXNoLCB0b2tlblJlY29yZC51c2VyX2lkXVxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gRGVsZXRlIHRoZSB0b2tlblxyXG4gICAgICBhd2FpdCBxdWVyeUZuKCdERUxFVEUgRlJPTSBwYXNzd29yZF9yZXNldF90b2tlbnMgV0hFUkUgdG9rZW5faWQgPSAkMScsIFt0b2tlblJlY29yZC50b2tlbl9pZF0pO1xyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVzZXR0aW5nIHBhc3N3b3JkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gQWNjb3VudCBtYW5hZ2VtZW50IC0gYWxsIG1ldGhvZHMgYXJlIHNlcnZlci1vbmx5XHJcbmV4cG9ydCBjb25zdCBhY2NvdW50TWFuYWdlciA9IHtcclxuICAvLyBDcmVhdGUgYSBuZXcgYWNjb3VudCB3aXRoIGFkbWluIHVzZXJcclxuICBhc3luYyBjcmVhdGVBY2NvdW50KGFjY291bnREYXRhLCB1c2VyRGF0YSkge1xyXG4gICAgLy8gRW5zdXJlIHdlJ3JlIHJ1bm5pbmcgb24gdGhlIHNlcnZlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gdGhlIHNlcnZlciBzaWRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gU3RhcnQgYSB0cmFuc2FjdGlvblxyXG4gICAgICBhd2FpdCBxdWVyeUZuKCdCRUdJTicpO1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIGFjY291bnRcclxuICAgICAgY29uc3QgYWNjb3VudFJlc3VsdCA9IGF3YWl0IHF1ZXJ5Rm4oXHJcbiAgICAgICAgJ0lOU0VSVCBJTlRPIGFjY291bnRzIChhY2NvdW50X25hbWUsIGFjY291bnRfZG9tYWluLCBwbGFuX2lkLCBiaWxsaW5nX2VtYWlsKSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0KSBSRVRVUk5JTkcgKicsXHJcbiAgICAgICAgW2FjY291bnREYXRhLmFjY291bnROYW1lLCBhY2NvdW50RGF0YS5hY2NvdW50RG9tYWluIHx8IG51bGwsIGFjY291bnREYXRhLnBsYW5JZCB8fCAxLCBhY2NvdW50RGF0YS5iaWxsaW5nRW1haWxdXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBhY2NvdW50ID0gYWNjb3VudFJlc3VsdC5yb3dzWzBdO1xyXG5cclxuICAgICAgLy8gSGFzaCBwYXNzd29yZFxyXG4gICAgICBjb25zdCBwYXNzd29yZEhhc2ggPSBhd2FpdCBhdXRoLmhhc2hQYXNzd29yZCh1c2VyRGF0YS5wYXNzd29yZCk7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgYWRtaW4gdXNlciAocm9sZV9pZCAxID0gQWRtaW4pXHJcbiAgICAgIGNvbnN0IHVzZXJSZXN1bHQgPSBhd2FpdCBxdWVyeUZuKFxyXG4gICAgICAgIGBJTlNFUlQgSU5UTyB1c2VycyAoYWNjb3VudF9pZCwgZW1haWwsIHBhc3N3b3JkX2hhc2gsIGZpcnN0X25hbWUsIGxhc3RfbmFtZSwgcm9sZV9pZCwgaXNfYWNjb3VudF9hZG1pbikgXHJcbiAgICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAxLCBUUlVFKSBSRVRVUk5JTkcgKmAsXHJcbiAgICAgICAgW2FjY291bnQuYWNjb3VudF9pZCwgdXNlckRhdGEuZW1haWwsIHBhc3N3b3JkSGFzaCwgdXNlckRhdGEuZmlyc3ROYW1lLCB1c2VyRGF0YS5sYXN0TmFtZV1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IGFkbWluID0gdXNlclJlc3VsdC5yb3dzWzBdO1xyXG5cclxuICAgICAgLy8gQ29tbWl0IHRyYW5zYWN0aW9uXHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oJ0NPTU1JVCcpO1xyXG5cclxuICAgICAgcmV0dXJuIHsgYWNjb3VudCwgYWRtaW4gfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIC8vIFJvbGxiYWNrIHRyYW5zYWN0aW9uIG9uIGVycm9yXHJcbiAgICAgIGF3YWl0IHF1ZXJ5Rm4oJ1JPTExCQUNLJyk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGFjY291bnQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBSZW1haW5pbmcgYWNjb3VudCBtYW5hZ2VyIG1ldGhvZHMgKHRydW5jYXRlZCBmb3IgYnJldml0eSlcclxuICAvLyBUaGUgcGF0dGVybiB3b3VsZCBiZSB0aGUgc2FtZSAtIHVzaW5nIHF1ZXJ5Rm4gYW5kIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG59O1xyXG5cclxuLy8gQ3JlYXRlIG1vY2sgaW1wbGVtZW50YXRpb25zIGZvciBjbGllbnQtc2lkZSB1c2VcclxuY29uc3QgY3JlYXRlTW9ja0F1dGggPSAoKSA9PiB7XHJcbiAgY29uc3QgbW9ja0F1dGggPSB7XHJcbiAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9ucyB0aGF0IGFyZSBzYWZlIHRvIHVzZSBvbiB0aGUgY2xpZW50XHJcbiAgICBhc3luYyBoYXNoUGFzc3dvcmQocGFzc3dvcmQpIHtcclxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgLy8gV2hlbiBydW5uaW5nIG9uIHRoZSBzZXJ2ZXIsIHVzZSB0aGUgcmVhbCBpbXBsZW1lbnRhdGlvblxyXG4gICAgICAgIHJldHVybiBhdXRoLmhhc2hQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIE9uIGNsaWVudCwganVzdCByZXR1cm4gYSBwbGFjZWhvbGRlciAocmVhbCBoYXNoaW5nIGhhcHBlbnMgc2VydmVyLXNpZGUpXHJcbiAgICAgIGNvbnNvbGUud2FybignaGFzaFBhc3N3b3JkIGNhbGxlZCBvbiBjbGllbnQsIHJlYWwgaGFzaGluZyB3aWxsIGhhcHBlbiBzZXJ2ZXItc2lkZScpO1xyXG4gICAgICByZXR1cm4gYG1vY2staGFzaC0ke3Bhc3N3b3JkLmxlbmd0aH1gO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyBjb21wYXJlUGFzc3dvcmQocGFzc3dvcmQsIGhhc2gpIHtcclxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgLy8gV2hlbiBydW5uaW5nIG9uIHRoZSBzZXJ2ZXIsIHVzZSB0aGUgcmVhbCBpbXBsZW1lbnRhdGlvblxyXG4gICAgICAgIHJldHVybiBhdXRoLmNvbXBhcmVQYXNzd29yZChwYXNzd29yZCwgaGFzaCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIE9uIGNsaWVudCwganVzdCByZXR1cm4gYSBwbGFjZWhvbGRlciAocmVhbCBjb21wYXJpc29uIGhhcHBlbnMgc2VydmVyLXNpZGUpXHJcbiAgICAgIGNvbnNvbGUud2FybignY29tcGFyZVBhc3N3b3JkIGNhbGxlZCBvbiBjbGllbnQsIHJlYWwgY29tcGFyaXNvbiB3aWxsIGhhcHBlbiBzZXJ2ZXItc2lkZScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIC8vIFRoZXNlIG1ldGhvZHMgc2hvdWxkIGJlIGNhbGxlZCB2aWEgQVBJIGVuZHBvaW50cyBvbiB0aGUgY2xpZW50XHJcbiAgICBhc3luYyBmaW5kVXNlckJ5RW1haWwoKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCB2aWEgYW4gQVBJIGVuZHBvaW50IG9uIGNsaWVudC1zaWRlJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGFzeW5jIGZpbmRVc2VyQnlJZCgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgY3JlYXRlU2Vzc2lvbigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgdmVyaWZ5U2Vzc2lvbigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgaW52YWxpZGF0ZVNlc3Npb24oKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCB2aWEgYW4gQVBJIGVuZHBvaW50IG9uIGNsaWVudC1zaWRlJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGFzeW5jIGNyZWF0ZVBhc3N3b3JkUmVzZXRUb2tlbigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgdmVyaWZ5UmVzZXRUb2tlbigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgcmVzZXRQYXNzd29yZCgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gbW9ja0F1dGg7XHJcbn07XHJcblxyXG4vLyBDcmVhdGUgYSBtb2NrIGFjY291bnQgbWFuYWdlciBmb3IgY2xpZW50LXNpZGUgdXNlXHJcbmNvbnN0IGNyZWF0ZU1vY2tBY2NvdW50TWFuYWdlciA9ICgpID0+IHtcclxuICBjb25zdCBtb2NrQWNjb3VudE1hbmFnZXIgPSB7XHJcbiAgICAvLyBBbGwgbWV0aG9kcyBzaG91bGQgYmUgY2FsbGVkIHZpYSBBUEkgZW5kcG9pbnRzIG9uIHRoZSBjbGllbnRcclxuICAgIGFzeW5jIGNyZWF0ZUFjY291bnQoKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCB2aWEgYW4gQVBJIGVuZHBvaW50IG9uIGNsaWVudC1zaWRlJyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGFzeW5jIGdldEFjY291bnRVc2VycygpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgY3JlYXRlVXNlcigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgdXBkYXRlVXNlcigpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgdXBkYXRlQWNjb3VudCgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIHZpYSBhbiBBUEkgZW5kcG9pbnQgb24gY2xpZW50LXNpZGUnKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gbW9ja0FjY291bnRNYW5hZ2VyO1xyXG59O1xyXG5cclxuLy8gRXhwb3J0IHRoZSBhcHByb3ByaWF0ZSBpbXBsZW1lbnRhdGlvbnMgYmFzZWQgb24gZW52aXJvbm1lbnRcclxuZXhwb3J0IGNvbnN0IGNsaWVudEF1dGggPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IGNyZWF0ZU1vY2tBdXRoKCkgOiBhdXRoO1xyXG5leHBvcnQgY29uc3QgY2xpZW50QWNjb3VudE1hbmFnZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IGNyZWF0ZU1vY2tBY2NvdW50TWFuYWdlcigpIDogYWNjb3VudE1hbmFnZXI7Il0sIm5hbWVzIjpbImJjcnlwdCIsInV1aWR2NCIsInF1ZXJ5Rm4iLCJwb29sT2JqIiwicmVxdWlyZSIsInY0IiwiZGJNb2R1bGUiLCJxdWVyeSIsInBvb2wiLCJlcnJvciIsImNvbnNvbGUiLCJoYXNoIiwiY29tcGFyZSIsIkVycm9yIiwiYXV0aCIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwid2FybiIsImxlbmd0aCIsImNvbXBhcmVQYXNzd29yZCIsImZpbmRVc2VyQnlFbWFpbCIsImVtYWlsIiwicmVzdWx0Iiwicm93cyIsImZpbmRVc2VyQnlJZCIsInVzZXJJZCIsImNyZWF0ZVNlc3Npb24iLCJzZXNzaW9uVG9rZW4iLCJleHBpcmVzQXQiLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJ2ZXJpZnlTZXNzaW9uIiwiaW52YWxpZGF0ZVNlc3Npb24iLCJjcmVhdGVQYXNzd29yZFJlc2V0VG9rZW4iLCJ0b2tlbiIsInNldEhvdXJzIiwiZ2V0SG91cnMiLCJ2ZXJpZnlSZXNldFRva2VuIiwicmVzZXRQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidG9rZW5SZWNvcmQiLCJzdWNjZXNzIiwicGFzc3dvcmRIYXNoIiwidXNlcl9pZCIsInRva2VuX2lkIiwiYWNjb3VudE1hbmFnZXIiLCJjcmVhdGVBY2NvdW50IiwiYWNjb3VudERhdGEiLCJ1c2VyRGF0YSIsImFjY291bnRSZXN1bHQiLCJhY2NvdW50TmFtZSIsImFjY291bnREb21haW4iLCJwbGFuSWQiLCJiaWxsaW5nRW1haWwiLCJhY2NvdW50IiwidXNlclJlc3VsdCIsImFjY291bnRfaWQiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImFkbWluIiwiY3JlYXRlTW9ja0F1dGgiLCJtb2NrQXV0aCIsImNyZWF0ZU1vY2tBY2NvdW50TWFuYWdlciIsIm1vY2tBY2NvdW50TWFuYWdlciIsImdldEFjY291bnRVc2VycyIsImNyZWF0ZVVzZXIiLCJ1cGRhdGVVc2VyIiwidXBkYXRlQWNjb3VudCIsImNsaWVudEF1dGgiLCJjbGllbnRBY2NvdW50TWFuYWdlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/db.js":
/*!*******************!*\
  !*** ./lib/db.js ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pool: () => (/* binding */ pool),\n/* harmony export */   query: () => (/* binding */ query)\n/* harmony export */ });\n// lib/db.js\n// Initialize query and pool as null\nlet pool = null;\nlet query = null;\n// Only run this code on the server\nif (true) {\n    try {\n        // Server-side code - import pg using require to avoid webpack issues\n        const { Pool } = __webpack_require__(/*! pg */ \"pg\");\n        // Create a database connection pool\n        pool =  false ? 0 : new Pool({\n            user: process.env.DB_USER || 'postgres',\n            host: process.env.DB_HOST || 'localhost',\n            database: process.env.DB_NAME || 'innvestai',\n            password: process.env.DB_PASSWORD || 'Temp@123',\n            port: parseInt(process.env.DB_PORT || '5432')\n        });\n        // Define the query function\n        query = async (text, params)=>{\n            try {\n                const start = Date.now();\n                const res = await pool.query(text, params);\n                const duration = Date.now() - start;\n                // Log query performance in development\n                if (true) {\n                    console.log('Executed query', {\n                        text,\n                        duration,\n                        rows: res.rowCount\n                    });\n                }\n                return res;\n            } catch (error) {\n                console.error('Database query error:', error);\n                throw error;\n            }\n        };\n        // Setup event handlers for the pool\n        pool.on('error', (err)=>{\n            console.error('Unexpected database error:', err);\n        // Don't crash the server on connection errors\n        });\n        console.log('Database module initialized on server');\n    } catch (error) {\n        console.error('Failed to initialize database module:', error);\n        // Create non-functional stubs if initialization fails\n        pool = {\n            query: ()=>{\n                throw new Error('Database pool not initialized');\n            },\n            on: ()=>{}\n        };\n        query = async ()=>{\n            throw new Error('Database query function not initialized');\n        };\n    }\n} else {}\n// Choose one export style based on the environment\n// Use ES modules export style since that's what the rest of your code uses\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLFlBQVk7QUFFWixvQ0FBb0M7QUFDcEMsSUFBSUEsT0FBTztBQUNYLElBQUlDLFFBQVE7QUFFWixtQ0FBbUM7QUFDbkMsSUFBSSxJQUE2QixFQUFFO0lBQ2pDLElBQUk7UUFDRixxRUFBcUU7UUFDckUsTUFBTSxFQUFFQyxJQUFJLEVBQUUsR0FBR0MsbUJBQU9BLENBQUMsY0FBSTtRQUU3QixvQ0FBb0M7UUFDcENILE9BQU9JLE1BQXFDLEdBQ3hDLENBS0UsR0FDRixJQUFJRixLQUFLO1lBQ1BRLE1BQU1OLFFBQVFFLEdBQUcsQ0FBQ0ssT0FBTyxJQUFJO1lBQzdCQyxNQUFNUixRQUFRRSxHQUFHLENBQUNPLE9BQU8sSUFBSTtZQUM3QkMsVUFBVVYsUUFBUUUsR0FBRyxDQUFDUyxPQUFPLElBQUk7WUFDakNDLFVBQVVaLFFBQVFFLEdBQUcsQ0FBQ1csV0FBVyxJQUFJO1lBQ3JDQyxNQUFNQyxTQUFTZixRQUFRRSxHQUFHLENBQUNjLE9BQU8sSUFBSTtRQUN4QztRQUVKLDRCQUE0QjtRQUM1Qm5CLFFBQVEsT0FBT29CLE1BQU1DO1lBQ25CLElBQUk7Z0JBQ0YsTUFBTUMsUUFBUUMsS0FBS0MsR0FBRztnQkFDdEIsTUFBTUMsTUFBTSxNQUFNMUIsS0FBS0MsS0FBSyxDQUFDb0IsTUFBTUM7Z0JBQ25DLE1BQU1LLFdBQVdILEtBQUtDLEdBQUcsS0FBS0Y7Z0JBRTlCLHVDQUF1QztnQkFDdkMsSUFBSW5CLElBQXFDLEVBQUU7b0JBQ3pDd0IsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQjt3QkFBRVI7d0JBQU1NO3dCQUFVRyxNQUFNSixJQUFJSyxRQUFRO29CQUFDO2dCQUNyRTtnQkFFQSxPQUFPTDtZQUNULEVBQUUsT0FBT00sT0FBTztnQkFDZEosUUFBUUksS0FBSyxDQUFDLHlCQUF5QkE7Z0JBQ3ZDLE1BQU1BO1lBQ1I7UUFDRjtRQUVBLG9DQUFvQztRQUNwQ2hDLEtBQUtpQyxFQUFFLENBQUMsU0FBUyxDQUFDQztZQUNoQk4sUUFBUUksS0FBSyxDQUFDLDhCQUE4QkU7UUFDNUMsOENBQThDO1FBQ2hEO1FBRUFOLFFBQVFDLEdBQUcsQ0FBQztJQUNkLEVBQUUsT0FBT0csT0FBTztRQUNkSixRQUFRSSxLQUFLLENBQUMseUNBQXlDQTtRQUV2RCxzREFBc0Q7UUFDdERoQyxPQUFPO1lBQ0xDLE9BQU87Z0JBQVEsTUFBTSxJQUFJa0MsTUFBTTtZQUFrQztZQUNqRUYsSUFBSSxLQUFPO1FBQ2I7UUFFQWhDLFFBQVE7WUFBYyxNQUFNLElBQUlrQyxNQUFNO1FBQTRDO0lBQ3BGO0FBQ0YsT0FBTyxFQVlOO0FBRUQsbURBQW1EO0FBQ25ELDJFQUEyRTtBQUNwRCIsInNvdXJjZXMiOlsiQzpcXHZpbm9kXFxwcm9qZWN0c1xcaW5udmVzdFxcUE9DXFxpbm52ZXN0YWlcXGxpYlxcZGIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL2RiLmpzXHJcblxyXG4vLyBJbml0aWFsaXplIHF1ZXJ5IGFuZCBwb29sIGFzIG51bGxcclxubGV0IHBvb2wgPSBudWxsO1xyXG5sZXQgcXVlcnkgPSBudWxsO1xyXG5cclxuLy8gT25seSBydW4gdGhpcyBjb2RlIG9uIHRoZSBzZXJ2ZXJcclxuaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFNlcnZlci1zaWRlIGNvZGUgLSBpbXBvcnQgcGcgdXNpbmcgcmVxdWlyZSB0byBhdm9pZCB3ZWJwYWNrIGlzc3Vlc1xyXG4gICAgY29uc3QgeyBQb29sIH0gPSByZXF1aXJlKCdwZycpO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIGRhdGFiYXNlIGNvbm5lY3Rpb24gcG9vbFxyXG4gICAgcG9vbCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgXHJcbiAgICAgID8gbmV3IFBvb2woe1xyXG4gICAgICAgICAgY29ubmVjdGlvblN0cmluZzogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLFxyXG4gICAgICAgICAgc3NsOiB7XHJcbiAgICAgICAgICAgIHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2VcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICA6IG5ldyBQb29sKHtcclxuICAgICAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkRCX1VTRVIgfHwgJ3Bvc3RncmVzJyxcclxuICAgICAgICAgIGhvc3Q6IHByb2Nlc3MuZW52LkRCX0hPU1QgfHwgJ2xvY2FsaG9zdCcsXHJcbiAgICAgICAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuREJfTkFNRSB8fCAnaW5udmVzdGFpJywgLy8gVXNlIGJ1aWx0LWluIHBvc3RncmVzIGRhdGFiYXNlXHJcbiAgICAgICAgICBwYXNzd29yZDogcHJvY2Vzcy5lbnYuREJfUEFTU1dPUkQgfHwgJ1RlbXBAMTIzJyxcclxuICAgICAgICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LkRCX1BPUlQgfHwgJzU0MzInKSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAvLyBEZWZpbmUgdGhlIHF1ZXJ5IGZ1bmN0aW9uXHJcbiAgICBxdWVyeSA9IGFzeW5jICh0ZXh0LCBwYXJhbXMpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XHJcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcG9vbC5xdWVyeSh0ZXh0LCBwYXJhbXMpO1xyXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIExvZyBxdWVyeSBwZXJmb3JtYW5jZSBpbiBkZXZlbG9wbWVudFxyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnRXhlY3V0ZWQgcXVlcnknLCB7IHRleHQsIGR1cmF0aW9uLCByb3dzOiByZXMucm93Q291bnQgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgcXVlcnkgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFNldHVwIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgcG9vbFxyXG4gICAgcG9vbC5vbignZXJyb3InLCAoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgZGF0YWJhc2UgZXJyb3I6JywgZXJyKTtcclxuICAgICAgLy8gRG9uJ3QgY3Jhc2ggdGhlIHNlcnZlciBvbiBjb25uZWN0aW9uIGVycm9yc1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIG1vZHVsZSBpbml0aWFsaXplZCBvbiBzZXJ2ZXInKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2UgbW9kdWxlOicsIGVycm9yKTtcclxuICAgIFxyXG4gICAgLy8gQ3JlYXRlIG5vbi1mdW5jdGlvbmFsIHN0dWJzIGlmIGluaXRpYWxpemF0aW9uIGZhaWxzXHJcbiAgICBwb29sID0ge1xyXG4gICAgICBxdWVyeTogKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIHBvb2wgbm90IGluaXRpYWxpemVkJyk7IH0sXHJcbiAgICAgIG9uOiAoKSA9PiB7fVxyXG4gICAgfTtcclxuXHJcbiAgICBxdWVyeSA9IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBxdWVyeSBmdW5jdGlvbiBub3QgaW5pdGlhbGl6ZWQnKTsgfTtcclxuICB9XHJcbn0gZWxzZSB7XHJcbiAgLy8gQ2xpZW50LXNpZGUgbW9jayBpbXBsZW1lbnRhdGlvblxyXG4gIHF1ZXJ5ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBxdWVyaWVzIGNhbm5vdCBiZSBleGVjdXRlZCBvbiB0aGUgY2xpZW50IHNpZGUnKTtcclxuICB9O1xyXG4gIFxyXG4gIHBvb2wgPSB7XHJcbiAgICBxdWVyeTogKCkgPT4ge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIHF1ZXJpZXMgY2Fubm90IGJlIGV4ZWN1dGVkIG9uIHRoZSBjbGllbnQgc2lkZScpO1xyXG4gICAgfSxcclxuICAgIG9uOiAoKSA9PiB7fVxyXG4gIH07XHJcbn1cclxuXHJcbi8vIENob29zZSBvbmUgZXhwb3J0IHN0eWxlIGJhc2VkIG9uIHRoZSBlbnZpcm9ubWVudFxyXG4vLyBVc2UgRVMgbW9kdWxlcyBleHBvcnQgc3R5bGUgc2luY2UgdGhhdCdzIHdoYXQgdGhlIHJlc3Qgb2YgeW91ciBjb2RlIHVzZXNcclxuZXhwb3J0IHsgcXVlcnksIHBvb2wgfTsiXSwibmFtZXMiOlsicG9vbCIsInF1ZXJ5IiwiUG9vbCIsInJlcXVpcmUiLCJwcm9jZXNzIiwiY29ubmVjdGlvblN0cmluZyIsImVudiIsIkRBVEFCQVNFX1VSTCIsInNzbCIsInJlamVjdFVuYXV0aG9yaXplZCIsInVzZXIiLCJEQl9VU0VSIiwiaG9zdCIsIkRCX0hPU1QiLCJkYXRhYmFzZSIsIkRCX05BTUUiLCJwYXNzd29yZCIsIkRCX1BBU1NXT1JEIiwicG9ydCIsInBhcnNlSW50IiwiREJfUE9SVCIsInRleHQiLCJwYXJhbXMiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJyZXMiLCJkdXJhdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJyb3dzIiwicm93Q291bnQiLCJlcnJvciIsIm9uIiwiZXJyIiwiRXJyb3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/db.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Flogin&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cauth%5Clogin.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Flogin&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cauth%5Clogin.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_login_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\auth\\login.js */ \"(api-node)/./pages/api/auth/login.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_login_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_login_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth/login\",\n        pathname: \"/api/auth/login\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_auth_login_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRmxvZ2luJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNhdXRoJTVDbG9naW4uanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDeUQ7QUFDekQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHFEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxxREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhdXRoXFxcXGxvZ2luLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoL2xvZ2luXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aC9sb2dpblwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Flogin&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cauth%5Clogin.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/auth/login.js":
/*!*********************************!*\
  !*** ./pages/api/auth/login.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_auth_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/auth.js */ \"(api-node)/./lib/auth.js\");\n/* harmony import */ var _lib_db_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/db.js */ \"(api-node)/./lib/db.js\");\n// pages/api/auth/login.js\n\n\n\nasync function handler(req, res) {\n    // Only accept POST requests\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    try {\n        const { email, password } = req.body;\n        // Validate inputs\n        if (!email || !password) {\n            return res.status(400).json({\n                error: 'Email and password are required'\n            });\n        }\n        try {\n            // Find user by email\n            const user = await _lib_auth_js__WEBPACK_IMPORTED_MODULE_1__.auth.findUserByEmail(email);\n            // Check if user exists\n            if (!user) {\n                return res.status(401).json({\n                    error: 'Invalid credentials'\n                });\n            }\n            // Check if user is active\n            if (!user.is_active) {\n                return res.status(401).json({\n                    error: 'Account is inactive. Please contact your administrator.'\n                });\n            }\n            // Check if account is active\n            if (!user.account_is_active) {\n                return res.status(401).json({\n                    error: 'Your organization account is inactive. Please contact support.'\n                });\n            }\n            // Verify password\n            const passwordValid = await _lib_auth_js__WEBPACK_IMPORTED_MODULE_1__.auth.comparePassword(password, user.password_hash);\n            if (!passwordValid) {\n                return res.status(401).json({\n                    error: 'Invalid credentials'\n                });\n            }\n            // Update last login time\n            await (0,_lib_db_js__WEBPACK_IMPORTED_MODULE_2__.query)('UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE user_id = $1', [\n                user.user_id\n            ]);\n            // Create a new session\n            const sessionToken = await _lib_auth_js__WEBPACK_IMPORTED_MODULE_1__.auth.createSession(user.user_id);\n            // Set session cookie\n            res.setHeader('Set-Cookie', cookie__WEBPACK_IMPORTED_MODULE_0___default().serialize('session_token', sessionToken, {\n                httpOnly: true,\n                secure: \"development\" === 'production',\n                maxAge: 60 * 60 * 24 * 7,\n                sameSite: 'strict',\n                path: '/'\n            }));\n            // Return user info without sensitive data\n            return res.status(200).json({\n                user: {\n                    id: user.user_id,\n                    email: user.email,\n                    firstName: user.first_name,\n                    lastName: user.last_name,\n                    accountId: user.account_id,\n                    accountName: user.account_name,\n                    role: user.role_name,\n                    isAdmin: user.is_account_admin\n                },\n                sessionToken\n            });\n        } catch (dbError) {\n            console.error('Database operation error during login:', dbError);\n            return res.status(500).json({\n                error: 'A database error occurred. Please check your database configuration.'\n            });\n        }\n    } catch (error) {\n        console.error('Login error:', error);\n        return res.status(500).json({\n            error: 'An error occurred during login'\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWlDO0lBQ3hFO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFx2aW5vZFxccHJvamVjdHNcXGlubnZlc3RcXFBPQ1xcaW5udmVzdGFpXFxwYWdlc1xcYXBpXFxhdXRoXFxsb2dpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvYXV0aC9sb2dpbi5qc1xyXG5pbXBvcnQgY29va2llIGZyb20gJ2Nvb2tpZSc7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICcuLi8uLi8uLi9saWIvYXV0aC5qcyc7XHJcbmltcG9ydCB7IHF1ZXJ5IH0gZnJvbSAnLi4vLi4vLi4vbGliL2RiLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcclxuICAvLyBPbmx5IGFjY2VwdCBQT1NUIHJlcXVlc3RzXHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dHNcclxuICAgIGlmICghZW1haWwgfHwgIXBhc3N3b3JkKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRW1haWwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gRmluZCB1c2VyIGJ5IGVtYWlsXHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoLmZpbmRVc2VyQnlFbWFpbChlbWFpbCk7XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0c1xyXG4gICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgY3JlZGVudGlhbHMnIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFjdGl2ZVxyXG4gICAgICBpZiAoIXVzZXIuaXNfYWN0aXZlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdBY2NvdW50IGlzIGluYWN0aXZlLiBQbGVhc2UgY29udGFjdCB5b3VyIGFkbWluaXN0cmF0b3IuJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2hlY2sgaWYgYWNjb3VudCBpcyBhY3RpdmVcclxuICAgICAgaWYgKCF1c2VyLmFjY291bnRfaXNfYWN0aXZlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdZb3VyIG9yZ2FuaXphdGlvbiBhY2NvdW50IGlzIGluYWN0aXZlLiBQbGVhc2UgY29udGFjdCBzdXBwb3J0LicgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZlcmlmeSBwYXNzd29yZFxyXG4gICAgICBjb25zdCBwYXNzd29yZFZhbGlkID0gYXdhaXQgYXV0aC5jb21wYXJlUGFzc3dvcmQocGFzc3dvcmQsIHVzZXIucGFzc3dvcmRfaGFzaCk7XHJcblxyXG4gICAgICBpZiAoIXBhc3N3b3JkVmFsaWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgY3JlZGVudGlhbHMnIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVcGRhdGUgbGFzdCBsb2dpbiB0aW1lXHJcbiAgICAgIGF3YWl0IHF1ZXJ5KFxyXG4gICAgICAgICdVUERBVEUgdXNlcnMgU0VUIGxhc3RfbG9naW4gPSBDVVJSRU5UX1RJTUVTVEFNUCBXSEVSRSB1c2VyX2lkID0gJDEnLFxyXG4gICAgICAgIFt1c2VyLnVzZXJfaWRdXHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgYSBuZXcgc2Vzc2lvblxyXG4gICAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSBhd2FpdCBhdXRoLmNyZWF0ZVNlc3Npb24odXNlci51c2VyX2lkKTtcclxuXHJcbiAgICAgIC8vIFNldCBzZXNzaW9uIGNvb2tpZVxyXG4gICAgICByZXMuc2V0SGVhZGVyKCdTZXQtQ29va2llJywgY29va2llLnNlcmlhbGl6ZSgnc2Vzc2lvbl90b2tlbicsIHNlc3Npb25Ub2tlbiwge1xyXG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcclxuICAgICAgICBtYXhBZ2U6IDYwICogNjAgKiAyNCAqIDcsIC8vIDEgd2Vla1xyXG4gICAgICAgIHNhbWVTaXRlOiAnc3RyaWN0JyxcclxuICAgICAgICBwYXRoOiAnLydcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgLy8gUmV0dXJuIHVzZXIgaW5mbyB3aXRob3V0IHNlbnNpdGl2ZSBkYXRhXHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgaWQ6IHVzZXIudXNlcl9pZCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0X25hbWUsXHJcbiAgICAgICAgICBsYXN0TmFtZTogdXNlci5sYXN0X25hbWUsXHJcbiAgICAgICAgICBhY2NvdW50SWQ6IHVzZXIuYWNjb3VudF9pZCxcclxuICAgICAgICAgIGFjY291bnROYW1lOiB1c2VyLmFjY291bnRfbmFtZSxcclxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZV9uYW1lLFxyXG4gICAgICAgICAgaXNBZG1pbjogdXNlci5pc19hY2NvdW50X2FkbWluXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXNzaW9uVG9rZW4gLy8gQ2xpZW50IHdpbGwgc3RvcmUgdGhpcyBpbiBhIGNvb2tpZVxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2Ugb3BlcmF0aW9uIGVycm9yIGR1cmluZyBsb2dpbjonLCBkYkVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBIGRhdGFiYXNlIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgY2hlY2sgeW91ciBkYXRhYmFzZSBjb25maWd1cmF0aW9uLicgfSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0xvZ2luIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnQW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGxvZ2luJyB9KTtcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiY29va2llIiwiYXV0aCIsInF1ZXJ5IiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImVtYWlsIiwicGFzc3dvcmQiLCJib2R5IiwidXNlciIsImZpbmRVc2VyQnlFbWFpbCIsImlzX2FjdGl2ZSIsImFjY291bnRfaXNfYWN0aXZlIiwicGFzc3dvcmRWYWxpZCIsImNvbXBhcmVQYXNzd29yZCIsInBhc3N3b3JkX2hhc2giLCJ1c2VyX2lkIiwic2Vzc2lvblRva2VuIiwiY3JlYXRlU2Vzc2lvbiIsInNldEhlYWRlciIsInNlcmlhbGl6ZSIsImh0dHBPbmx5Iiwic2VjdXJlIiwicHJvY2VzcyIsIm1heEFnZSIsInNhbWVTaXRlIiwicGF0aCIsImlkIiwiZmlyc3ROYW1lIiwiZmlyc3RfbmFtZSIsImxhc3ROYW1lIiwibGFzdF9uYW1lIiwiYWNjb3VudElkIiwiYWNjb3VudF9pZCIsImFjY291bnROYW1lIiwiYWNjb3VudF9uYW1lIiwicm9sZSIsInJvbGVfbmFtZSIsImlzQWRtaW4iLCJpc19hY2NvdW50X2FkbWluIiwiZGJFcnJvciIsImNvbnNvbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/auth/login.js\n");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "uuid":
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("uuid");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Flogin&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cauth%5Clogin.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();